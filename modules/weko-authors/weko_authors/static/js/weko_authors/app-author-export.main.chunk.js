(this["webpackJsonpapp-author-export"]=this["webpackJsonpapp-author-export"]||[]).push([[0],{395:function(e,t,n){},401:function(e,t,n){"use strict";n.r(t);n(199),n(209);var r=n(0),a=n.n(r),s=n(49),c=n.n(s),o=n(129),i=n(41),l=n.n(i),d=n(80),u=n(193),m=n(194),p=n(197),x=n(196),j=(n(395),n(396),document.getElementById("errors"),document.getElementById("export_all").value),h=document.getElementById("export").value,b=document.getElementById("export_message").value,g=document.getElementById("cancel_message").value,v=document.getElementById("confirm_label").value,f=document.getElementById("run").value,O=document.getElementById("cancel").value,k=document.getElementById("download_url").value,y=document.getElementById("internal_server_error").value,E=document.getElementById("is_exporting_error").value,w=document.getElementById("is_exporting_other_device_error").value,C=document.getElementById("cancel_export_error").value,_=JSON.parse(document.getElementById("export_authors_entrypoints").value),M=n(403),N=n(4);var S=function(e){var t=e.show,n=e.confirmMessage,r=e.onAction,a=e.onClose;return Object(N.jsxs)(M.a,{className:"opacity1",show:-1!==t,onHide:a,dialogClassName:"w-725",children:[Object(N.jsx)(M.a.Header,{closeButton:!0,children:Object(N.jsx)(M.a.Title,{className:"in-line",children:v})}),Object(N.jsx)(M.a.Body,{children:Object(N.jsx)("div",{className:"row text-center",children:n})}),Object(N.jsx)(M.a.Footer,{children:Object(N.jsx)("div",{className:"col-sm-12",children:Object(N.jsxs)("div",{className:"row text-center",children:[Object(N.jsx)("button",{variant:"primary",type:"button",className:"btn btn-default",onClick:function(){return r(1===t)},children:f}),Object(N.jsx)("button",{variant:"secondary",type:"button",className:"btn btn-default cancel",onClick:a,children:O})]})})})]})},I=n(404);var B=function(e){var t=e.type,n=void 0===t?"danger":t,r=e.msg,a=void 0===r?"":r,s=e.onClose;return""!==a?Object(N.jsx)(I.a,{variant:n,onClose:s,className:"opacity1",dismissible:!0,children:a}):""},T=function(e){Object(p.a)(n,e);var t=Object(x.a)(n);function n(){var e;return Object(u.a)(this,n),(e=t.call(this)).onAction=function(t){t?e.onExport():e.onCancel(),e.onClose()},e.onConfirm=function(t){e.setState({showConfirmModal:t?1:0,confirmMessage:t?b:g})},e.onCancel=Object(d.a)(l.a.mark((function t(){var n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(_.cancel,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:e.state.taskId})});case 3:return n=t.sent,t.next=6,n.json();case 6:(r=t.sent).data&&"success"===r.data.status?e.setState({isExporting:!1}):e.setState({errorMsg:C}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),e.setState({errorMsg:y});case 13:case"end":return t.stop()}}),t,null,[[0,10]])}))),e.onExport=Object(d.a)(l.a.mark((function t(){var n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkExportStatus(!1,!0);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,fetch(_.export,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});case 8:return n=t.sent,t.next=11,n.json();case 11:(r=t.sent).data&&(e.setState({taskId:r.data.task_id}),localStorage.setItem("authors_export_id",r.data.task_id),e.checkExportStatus(!0)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),e.setState({isExporting:!1,errorMsg:y});case 18:case"end":return t.stop()}}),t,null,[[5,15]])}))),e.checkExportStatus=Object(d.a)(l.a.mark((function t(){var n,r,a=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>0&&void 0!==a[0]&&a[0],r=a.length>1&&void 0!==a[1]&&a[1],e.setState({isChecking:!0}),t.next=5,new Promise((function(t){var a=setInterval(Object(d.a)(l.a.mark((function s(){var c,i,d,u,m;return l.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return c={errorMsg:""},s.prev=1,i=e.state.taskId,s.next=5,fetch(_.check_status,{method:"GET"});case 5:return d=s.sent,s.next=8,d.json();case 8:(u=s.sent).data?((m=u.data).task_id&&i===m.task_id?(c.isExporting=!0,n=!0):m.task_id?c.errorMsg=w:m.error?c.errorMsg=E:n&&(n=!1,c.isExporting=!1),c.downloadLink=m.download_link,c.filename=m.filename):c.errorMsg=y,s.next=15;break;case 12:s.prev=12,s.t0=s.catch(1),c.errorMsg=y;case 15:c.errorMsg&&(c.isExporting=!1),r&&e.setState({isExporting:!0}),!n||c.errorMsg?(e.setState(Object(o.a)({isChecking:!1},c)),t(""===e.state.errorMsg&&!c.isExporting),clearInterval(a)):e.setState(Object(o.a)({},c));case 18:case"end":return s.stop()}}),s,null,[[1,12]])}))),1e3)}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),e.onClose=function(){e.setState({showConfirmModal:-1})},e.state={showConfirmModal:-1,isDisableExport:!1,isDisableCancel:!0,confirmMessage:"",isChecking:!1,isExporting:!1,errorMsg:"",taskId:localStorage.getItem("authors_export_id"),downloadLink:"",filename:""},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.checkExportStatus()}},{key:"render",value:function(){var e=this,t=this.state,n=t.errorMsg,r=t.downloadLink,a=t.filename,s=t.isExporting,c=t.isChecking,o=t.showConfirmModal,i=t.confirmMessage;return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)("div",{className:"col-sm-12",children:[Object(N.jsx)(B,{type:"danger",msg:n,onClose:function(){return e.setState({errorMsg:""})}}),Object(N.jsx)("div",{className:"row",children:Object(N.jsx)("div",{className:"col-sm-12",children:Object(N.jsx)("label",{children:j})})}),Object(N.jsx)("div",{className:"row",children:Object(N.jsxs)("div",{className:"col-sm-12 text-center",children:[Object(N.jsxs)("button",{disabled:s||c,type:"button",className:"btn btn-primary margin",onClick:function(){return e.onConfirm(!0)},children:[s||c?Object(N.jsx)("div",{className:"loading"}):Object(N.jsx)(N.Fragment,{}),h]}),Object(N.jsx)("button",{disabled:!s,type:"button",className:"btn btn-primary margin cancel",onClick:function(){return e.onConfirm(!1)},children:O})]})}),Object(N.jsx)("div",{className:"row",children:Object(N.jsx)("div",{className:"col-sm-12",children:Object(N.jsx)("label",{children:k})})}),Object(N.jsx)("div",{className:"row",children:Object(N.jsx)("div",{className:"col-sm-12",children:Object(N.jsx)("a",{href:r,children:a})})})]}),Object(N.jsx)(S,{show:o,confirmMessage:i,onAction:this.onAction,onClose:this.onClose})]})}}]),n}(a.a.Component);c.a.render(Object(N.jsx)(a.a.StrictMode,{children:Object(N.jsx)(T,{})}),document.getElementById("app-author-export"))}},[[401,1,2]]]);
//# sourceMappingURL=main.ea634c85.chunk.js.map