(this["webpackJsonpapp-author-export"]=this["webpackJsonpapp-author-export"]||[]).push([[0],{478:function(e,t,n){},484:function(e,t,n){"use strict";n.r(t);n(255),n(274);var a=n(1),r=n.n(a),s=n(57),c=n.n(s),o=n(168),i=n(46),l=n(84),d=n(249),u=n(250),m=n(253),p=n(251),b=(n(478),n(479),document.getElementById("errors"),document.getElementById("export_all").value),j=document.getElementById("export").value,x=document.getElementById("export_message").value,h=document.getElementById("cancel_message").value,g=document.getElementById("confirm_label").value,v=document.getElementById("export_target").value,f=document.getElementById("author_db_label").value,O=document.getElementById("id_prefix_label").value,_=document.getElementById("affiliation_id_label").value,y=document.getElementById("run").value,k=document.getElementById("cancel").value,S=document.getElementById("download_url").value,E=document.getElementById("internal_server_error").value,C=document.getElementById("is_exporting_error").value,w=document.getElementById("is_exporting_other_device_error").value,N=document.getElementById("cancel_export_error").value,I=(document.getElementById("export_url_label").value,document.getElementById("resume_label").value),M=JSON.parse(document.getElementById("export_authors_entrypoints").value),B=n(486),T=n(5);var J=function(e){var t=e.show,n=e.confirmMessage,a=e.onAction,r=e.onClose;return Object(T.jsxs)(B.a,{className:"opacity1",show:-1!==t,onHide:r,dialogClassName:"w-725",children:[Object(T.jsx)(B.a.Header,{closeButton:!0,children:Object(T.jsx)(B.a.Title,{className:"in-line",children:g})}),Object(T.jsx)(B.a.Body,{children:Object(T.jsx)("div",{className:"row text-center",children:n})}),Object(T.jsx)(B.a.Footer,{children:Object(T.jsx)("div",{className:"col-sm-12",children:Object(T.jsxs)("div",{className:"row text-center",children:[Object(T.jsx)("button",{variant:"primary",type:"button",className:"btn btn-default",onClick:function(){return a(1===t)},children:y}),Object(T.jsx)("button",{variant:"secondary",type:"button",className:"btn btn-default cancel",onClick:r,children:k})]})})})]})},A=n(487);var P=function(e){var t=e.type,n=void 0===t?"danger":t,a=e.msg,r=void 0===a?"":a,s=e.onClose;return""!==r?Object(T.jsx)(A.a,{variant:n,onClose:s,className:"opacity1",dismissible:!0,children:r}):""},D=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(m.a)(this,t)).onAction=function(t){t?e.onExport():e.onCancel(),e.onClose()},e.onChangeTarget=function(t){e.setState({isTarget:t.target.value})},e.onConfirm=function(t){e.setState({showConfirmModal:t?1:0,confirmMessage:t?x:h})},e.onCancel=Object(l.a)(Object(i.a)().mark((function t(){var n,a;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(M.cancel,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:e.state.taskId})});case 3:return n=t.sent,t.next=6,n.json();case 6:(a=t.sent).data&&"success"===a.data.status?e.setState({isExporting:!1,isStopping:!1}):e.setState({errorMsg:N}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),e.setState({errorMsg:E});case 13:case"end":return t.stop()}}),t,null,[[0,10]])}))),e.onExport=Object(l.a)(Object(i.a)().mark((function t(){var n,a;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkExportStatus(!1,!0);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,fetch(M.export,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isTarget:e.state.isTarget})});case 8:return n=t.sent,t.next=11,n.json();case 11:(a=t.sent).data&&(e.setState({taskId:a.data.task_id}),localStorage.setItem("authors_export_id",a.data.task_id),e.checkExportStatus(!0)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),e.setState({isExporting:!1,errorMsg:E});case 18:case"end":return t.stop()}}),t,null,[[5,15]])}))),e.onResume=Object(l.a)(Object(i.a)().mark((function t(){var n,a;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({isStopping:!1}),t.next=3,e.checkExportStatus(!1,!0);case 3:if(t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,t.next=9,fetch(M.resume,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isTarget:e.state.isTarget})});case 9:return n=t.sent,t.next=12,n.json();case 12:(a=t.sent).data&&(e.setState({taskId:a.data.task_id}),localStorage.setItem("authors_export_id",a.data.task_id),e.checkExportStatus(!0)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),e.setState({isExporting:!1,errorMsg:E});case 19:case"end":return t.stop()}}),t,null,[[6,16]])}))),e.checkExportStatus=Object(l.a)(Object(i.a)().mark((function t(){var n,a,r=arguments;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>0&&void 0!==r[0]&&r[0],a=r.length>1&&void 0!==r[1]&&r[1],e.setState({isChecking:!0}),t.next=5,new Promise((function(t){var r=setInterval(Object(l.a)(Object(i.a)().mark((function s(){var c,l,d,u,m;return Object(i.a)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return c={errorMsg:""},s.prev=1,l=e.state.taskId,s.next=5,fetch(M.check_status,{method:"GET"});case 5:return d=s.sent,s.next=8,d.json();case 8:(u=s.sent).data?((m=u.data).task_id&&l===m.task_id?(c.isExporting=!0,n=!0):m.stop_point?(c.isStopping=!0,n=!1):m.task_id?c.errorMsg=w:m.error?c.errorMsg=C:n&&(n=!1,c.isExporting=!1),c.downloadLink=m.download_link,c.filename=m.filename):c.errorMsg=E,s.next=15;break;case 12:s.prev=12,s.t0=s.catch(1),c.errorMsg=E;case 15:c.errorMsg&&(c.isExporting=!1),a?(e.setState({isExporting:!0}),e.setState({isStopping:!1})):c.isStopping&&(e.setState({isStopping:!0}),e.setState({isExporting:!1})),!n||c.errorMsg?(e.setState(Object(o.a)({isChecking:!1},c)),t(""===e.state.errorMsg&&!c.isExporting),clearInterval(r)):e.setState(Object(o.a)({},c));case 18:case"end":return s.stop()}}),s,null,[[1,12]])}))),1e3)}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),e.onClose=function(){e.setState({showConfirmModal:-1})},e.state={showConfirmModal:-1,isDisableExport:!1,isDisableCancel:!0,confirmMessage:"",isChecking:!1,isExporting:!1,isTarget:"author_db",isStopping:!1,errorMsg:"",taskId:localStorage.getItem("authors_export_id"),downloadLink:"",filename:""},e}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.checkExportStatus()}},{key:"render",value:function(){var e,t=this,n=this.state,a=n.errorMsg,r=n.downloadLink,s=n.filename,c=n.isExporting,o=n.isChecking,i=n.isTarget,l=n.isStopping,d=n.showConfirmModal,u=n.confirmMessage;"author_db"===i?e=f:"id_prefix"===i?e=O:"affiliation_id"===i&&(e=_);var m,p="",x="";return(s.startsWith("Creator_export")&&"author_db"===i||s.startsWith("Id_prefix_export")&&"id_prefix"===i||s.startsWith("Affiliation_id_export")&&"affiliation_id"===i)&&(p=r,x=s),m=c?Object(T.jsxs)("button",{disabled:!0,type:"button",className:"btn btn-primary margin",children:[Object(T.jsx)("div",{className:"loading"}),j]}):o?Object(T.jsxs)("button",{disabled:!0,type:"button",className:"btn btn-primary margin",children:[Object(T.jsx)("div",{className:"loading"})," ",j]}):l?Object(T.jsx)("button",{type:"button",className:"btn btn-primary margin",onClick:this.onResume,children:I}):Object(T.jsx)("button",{type:"button",className:"btn btn-primary margin",onClick:function(){return t.onConfirm(!0)},children:j}),Object(T.jsxs)(T.Fragment,{children:[Object(T.jsxs)("div",{className:"col-sm-12",children:[Object(T.jsx)(P,{type:"danger",msg:a,onClose:function(){return t.setState({errorMsg:""})}}),Object(T.jsx)("div",{className:"row",children:Object(T.jsx)("div",{className:"col-md-2 col-cd",children:Object(T.jsx)("label",{children:v})})}),Object(T.jsx)("div",{className:"row",children:Object(T.jsx)("div",{className:"select-margin",children:Object(T.jsx)("div",{children:Object(T.jsxs)("select",{className:"form-control",defaultValue:"author_db",onChange:this.onChangeTarget,children:[Object(T.jsx)("option",{value:"author_db",children:f}),Object(T.jsx)("option",{value:"id_prefix",children:O}),Object(T.jsx)("option",{value:"affiliation_id",children:_})]})})})}),Object(T.jsx)("div",{className:"row",children:Object(T.jsx)("div",{className:"col-sm-12",children:Object(T.jsx)("label",{children:b})})}),Object(T.jsx)("div",{className:"row",children:Object(T.jsxs)("div",{className:"col-sm-12 text-center",children:[m,Object(T.jsx)("button",{disabled:!c&&!l,type:"button",className:"btn btn-primary margin cancel",onClick:function(){return t.onConfirm(!1)},children:k})]})}),Object(T.jsx)("div",{className:"row",children:Object(T.jsx)("div",{className:"col-sm-12",children:Object(T.jsx)("label",{children:S})})}),Object(T.jsx)("div",{className:"row",children:Object(T.jsxs)("div",{className:"col-sm-12",children:[p?e+"\uff1a":"",Object(T.jsx)("a",{href:p,children:x})]})})]}),Object(T.jsx)(J,{show:d,confirmMessage:u,onAction:this.onAction,onClose:this.onClose})]})}}])}(r.a.Component),L=D;c.a.render(Object(T.jsx)(r.a.StrictMode,{children:Object(T.jsx)(L,{})}),document.getElementById("app-author-export"))}},[[484,1,2]]]);
//# sourceMappingURL=main.b62cce0d.chunk.js.map