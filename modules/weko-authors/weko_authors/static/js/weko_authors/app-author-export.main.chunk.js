(this["webpackJsonpapp-author-export"]=this["webpackJsonpapp-author-export"]||[]).push([[0],{478:function(e,t,n){},484:function(e,t,n){"use strict";n.r(t);n(255),n(274);var r=n(1),a=n.n(r),s=n(57),c=n.n(s),o=n(168),i=n(46),l=n(84),d=n(249),u=n(250),p=n(253),m=n(251),b=(n(478),n(479),document.getElementById("errors"),document.getElementById("export_all").value),j=document.getElementById("export").value,x=document.getElementById("export_message").value,h=document.getElementById("cancel_message").value,g=document.getElementById("confirm_label").value,v=document.getElementById("run").value,O=document.getElementById("cancel").value,f=document.getElementById("download_url").value,k=document.getElementById("internal_server_error").value,y=document.getElementById("is_exporting_error").value,S=document.getElementById("is_exporting_other_device_error").value,E=document.getElementById("cancel_export_error").value,_=document.getElementById("export_url_label").value,w=document.getElementById("resume_label").value,C=JSON.parse(document.getElementById("export_authors_entrypoints").value),N=n(486),I=n(6);var M=function(e){var t=e.show,n=e.confirmMessage,r=e.onAction,a=e.onClose;return Object(I.jsxs)(N.a,{className:"opacity1",show:-1!==t,onHide:a,dialogClassName:"w-725",children:[Object(I.jsx)(N.a.Header,{closeButton:!0,children:Object(I.jsx)(N.a.Title,{className:"in-line",children:g})}),Object(I.jsx)(N.a.Body,{children:Object(I.jsx)("div",{className:"row text-center",children:n})}),Object(I.jsx)(N.a.Footer,{children:Object(I.jsx)("div",{className:"col-sm-12",children:Object(I.jsxs)("div",{className:"row text-center",children:[Object(I.jsx)("button",{variant:"primary",type:"button",className:"btn btn-default",onClick:function(){return r(1===t)},children:v}),Object(I.jsx)("button",{variant:"secondary",type:"button",className:"btn btn-default cancel",onClick:a,children:O})]})})})]})},B=n(487);var T=function(e){var t=e.type,n=void 0===t?"danger":t,r=e.msg,a=void 0===r?"":r,s=e.onClose;return""!==a?Object(I.jsx)(B.a,{variant:n,onClose:s,className:"opacity1",dismissible:!0,children:a}):""},J=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(p.a)(this,t)).onAction=function(t){t?e.onExport():e.onCancel(),e.onClose()},e.onConfirm=function(t){e.setState({showConfirmModal:t?1:0,confirmMessage:t?x:h})},e.onCancel=Object(l.a)(Object(i.a)().mark((function t(){var n,r;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(C.cancel,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:e.state.taskId})});case 3:return n=t.sent,t.next=6,n.json();case 6:(r=t.sent).data&&"success"===r.data.status?e.setState({isExporting:!1,isStopping:!1}):e.setState({errorMsg:E}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),e.setState({errorMsg:k});case 13:case"end":return t.stop()}}),t,null,[[0,10]])}))),e.onExport=Object(l.a)(Object(i.a)().mark((function t(){var n,r;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkExportStatus(!1,!0);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,fetch(C.export,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});case 8:return n=t.sent,t.next=11,n.json();case 11:(r=t.sent).data&&(e.setState({taskId:r.data.task_id}),localStorage.setItem("authors_export_id",r.data.task_id),e.checkExportStatus(!0)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),e.setState({isExporting:!1,errorMsg:k});case 18:case"end":return t.stop()}}),t,null,[[5,15]])}))),e.onResume=Object(l.a)(Object(i.a)().mark((function t(){var n,r;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({isStopping:!1}),t.next=3,e.checkExportStatus(!1,!0);case 3:if(t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,t.next=9,fetch(C.resume,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});case 9:return n=t.sent,t.next=12,n.json();case 12:(r=t.sent).data&&(e.setState({taskId:r.data.task_id}),localStorage.setItem("authors_export_id",r.data.task_id),e.checkExportStatus(!0)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),e.setState({isExporting:!1,errorMsg:k});case 19:case"end":return t.stop()}}),t,null,[[6,16]])}))),e.checkExportStatus=Object(l.a)(Object(i.a)().mark((function t(){var n,r,a=arguments;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>0&&void 0!==a[0]&&a[0],r=a.length>1&&void 0!==a[1]&&a[1],e.setState({isChecking:!0}),t.next=5,new Promise((function(t){var a=setInterval(Object(l.a)(Object(i.a)().mark((function s(){var c,l,d,u,p;return Object(i.a)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return c={errorMsg:""},s.prev=1,l=e.state.taskId,s.next=5,fetch(C.check_status,{method:"GET"});case 5:return d=s.sent,s.next=8,d.json();case 8:(u=s.sent).data?((p=u.data).task_id&&l===p.task_id?(c.isExporting=!0,n=!0):p.stop_point?(c.isStopping=!0,n=!1):p.task_id?c.errorMsg=S:p.error?c.errorMsg=y:n&&(n=!1,c.isExporting=!1),c.downloadLink=p.download_link,c.filename=p.filename):c.errorMsg=k,s.next=15;break;case 12:s.prev=12,s.t0=s.catch(1),c.errorMsg=k;case 15:c.errorMsg&&(c.isExporting=!1),r?(e.setState({isExporting:!0}),e.setState({isStopping:!1})):c.isStopping&&(e.setState({isStopping:!0}),e.setState({isExporting:!1})),!n||c.errorMsg?(e.setState(Object(o.a)({isChecking:!1},c)),t(""===e.state.errorMsg&&!c.isExporting),clearInterval(a)):e.setState(Object(o.a)({},c));case 18:case"end":return s.stop()}}),s,null,[[1,12]])}))),1e3)}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),e.onClose=function(){e.setState({showConfirmModal:-1})},e.state={showConfirmModal:-1,isDisableExport:!1,isDisableCancel:!0,confirmMessage:"",isChecking:!1,isExporting:!1,isStopping:!1,errorMsg:"",taskId:localStorage.getItem("authors_export_id"),downloadLink:"",filename:""},e}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.checkExportStatus()}},{key:"render",value:function(){var e,t=this,n=this.state,r=n.errorMsg,a=n.downloadLink,s=n.filename,c=n.isExporting,o=n.isChecking,i=n.isStopping,l=n.showConfirmModal,d=n.confirmMessage;return e=c?Object(I.jsxs)("button",{disabled:!0,type:"button",className:"btn btn-primary margin",children:[Object(I.jsx)("div",{className:"loading"}),j]}):o?Object(I.jsxs)("button",{disabled:!0,type:"button",className:"btn btn-primary margin",children:[Object(I.jsx)("div",{className:"loading"})," ",j]}):i?Object(I.jsx)("button",{type:"button",className:"btn btn-primary margin",onClick:this.onResume,children:w}):Object(I.jsx)("button",{type:"button",className:"btn btn-primary margin",onClick:function(){return t.onConfirm(!0)},children:j}),Object(I.jsxs)(I.Fragment,{children:[Object(I.jsxs)("div",{className:"col-sm-12",children:[Object(I.jsx)(T,{type:"danger",msg:r,onClose:function(){return t.setState({errorMsg:""})}}),Object(I.jsx)("div",{className:"row",children:Object(I.jsx)("div",{className:"col-sm-12",children:Object(I.jsx)("label",{children:b})})}),Object(I.jsx)("div",{className:"row",children:Object(I.jsxs)("div",{className:"col-sm-12 text-center",children:[e,Object(I.jsx)("button",{disabled:!c&&!i,type:"button",className:"btn btn-primary margin cancel",onClick:function(){return t.onConfirm(!1)},children:O})]})}),Object(I.jsx)("div",{className:"row",children:Object(I.jsx)("div",{className:"col-sm-12",children:Object(I.jsx)("label",{children:f})})}),Object(I.jsx)("div",{className:"row",children:Object(I.jsxs)("div",{className:"col-sm-12",children:[_,"\uff1a",Object(I.jsx)("a",{href:a,children:s})]})})]}),Object(I.jsx)(M,{show:l,confirmMessage:d,onAction:this.onAction,onClose:this.onClose})]})}}])}(a.a.Component),A=J;c.a.render(Object(I.jsx)(a.a.StrictMode,{children:Object(I.jsx)(A,{})}),document.getElementById("app-author-export"))}},[[484,1,2]]]);
//# sourceMappingURL=main.c61dbfef.chunk.js.map