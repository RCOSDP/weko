(this["webpackJsonpapp-author-import"]=this["webpackJsonpapp-author-import"]||[]).push([[0],{466:function(e,t,a){},474:function(e,t,a){"use strict";a.r(t);a(243),a(262);var n=a(3),r=a.n(n),s=a(66),c=a.n(s),i=a(18),l=a(35),o=a(54),d=a(55),u=a(57),m=a(56),j=(a(466),a(467),document.getElementById("select").value),b=document.getElementById("import").value,h=document.getElementById("result").value,p=document.getElementById("download").value,f=document.getElementById("no").value,x=document.getElementById("weko_id").value,O=document.getElementById("name").value,v=document.getElementById("select_file").value,_=document.getElementById("selected_file_name").value,g=document.getElementById("next").value,y=document.getElementById("import_target").value,k=document.getElementById("author_db_label").value,I=document.getElementById("id_prefix_label").value,N=document.getElementById("affiliation_id_label").value,w=document.getElementById("summary").value,E=document.getElementById("total").value,S=document.getElementById("new_creator").value,T=document.getElementById("update_creator").value,B=document.getElementById("delete_creator").value,C=document.getElementById("check_error").value,D=document.getElementById("mail_address").value,M=document.getElementById("check_result").value,F=document.getElementById("scheme").value,L=document.getElementById("scheme_name").value,P=document.getElementById("scheme_url").value,Y=document.getElementById("start_date").value,A=document.getElementById("end_date").value,U=document.getElementById("status").value,R=document.getElementById("to_do").value,J=document.getElementById("register_success").value,H=document.getElementById("update_success").value,G=document.getElementById("delete_success").value,V=document.getElementById("error").value,q=document.getElementById("warning").value,z=document.getElementById("register").value,K=document.getElementById("update").value,Q=document.getElementById("deleted").value,W=document.getElementById("different_format_file_for_target").value,X=document.getElementById("internal_server_error").value,Z=document.getElementById("celery_not_run").value,$=document.getElementById("not_available_error").value,ee=document.getElementById("not_available_error_another").value,te=document.getElementById("import_fail_error").value,ae=document.getElementById("delete_author_link").value,ne=JSON.parse(document.getElementById("import_authors_entrypoints").value),re=0,se=1,ce=2,ie=[{tab_key:"select",tab_name:j,step:re},{tab_key:"import",tab_name:b,step:se},{tab_key:"result",tab_name:h,step:ce}],le=0,oe=1,de=2,ue=3,me="import_author_task_id",je=r.a.createContext({}),be=function(e){return e?e.filter((function(e){return null!=e&&""!==e})):[]},he=function(e){return e?be(e.map((function(e){var t=e.familyName&&e.firstName?", ":"";return e.familyName+t+e.firstName}))):[]},pe=function(e,t,a){var n="object"!==typeof e?JSON.parse(e):e,r="";if(a){var s="";for(var c in n[0])s+=c+"\t";r+=(s=s.slice(0,-1))+"\r\n"}for(var i=0;i<n.length;i++){var l="";for(var o in n[i])l+='"'+n[i][o]+'"\t';r+=(l=l.slice(0,-1))+"\r\n"}if(""!==r){var d=t.replace(/ /g,"_")+".tsv",u=new Blob([r],{type:"text/tsv"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(u,d);else{var m=window.URL.createObjectURL(u),j=document.createElement("a");j.style.display="none",j.href=m,j.download=d,document.body.appendChild(j),j.click(),document.body.removeChild(j),window.URL.revokeObjectURL(m)}}else alert("Invalid data")},fe=a(157),xe=a.n(fe),Oe=a(0),ve=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,t,[e])).getLastString=function(e,t){return e.split(t).pop()},a.onChangeTarget=function(e){var t=a.context.setTarget;a.setState({file:null,fileName:""}),t(e.target.value)},a.onChangeFile=function(){var e=Object(l.a)(Object(i.a)().mark((function e(t){var n,r,s,c,l,o,d,u,m,j,b,h,p,f;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.context,r=n.isTarget,s=n.setErrorMessage,c=t.target.files[0],l=a.getLastString(t.target.value,"\\"),"tsv"===a.getLastString(l,".")){e.next=5;break}return e.abrupt("return",!1);case 5:a.setState({fileName:l}),o=c.stream().getReader(),d=new TextDecoder("utf-8"),u="",m="",j=!0;case 11:if(!j){e.next=30;break}return e.next=14,o.read();case 14:if(b=e.sent,h=b.done,p=b.value,!h){e.next=19;break}return e.abrupt("break",30);case 19:if(u+=d.decode(p,{stream:!0}),m=u.split("\n")[0],a.validateFirstLine(r,m)){e.next=27;break}return s(W),e.abrupt("return");case 27:j=!1;case 28:e.next=11;break;case 30:(f=new FileReader).onload=function(){a.setState({file:f.result})},f.readAsDataURL(c);case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.validateFirstLine=function(e,t){var a=!0,n=t.trim();return"id_prefix"===e?a="#author_prefix_settings"===n:"affiliation_id"===e?a="#author_affiliation_settings"===n:"author_db"===e&&(a="#author_prefix_settings"!==n&&"#author_affiliation_settings"!==n),a},a.onCheckImportFile=Object(l.a)(Object(i.a)().mark((function e(){var t,n,r,s,c,l,o,d,u;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.context,n=t.setImportData,r=t.isTarget,s=t.setErrorMessage,c=a.state,l=c.fileName,o=c.file){e.next=4;break}return e.abrupt("return");case 4:return a.setState({isChecking:!0}),e.prev=5,e.next=8,fetch(ne.check_import_file,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_name:l,file:o,target:r})});case 8:return d=e.sent,e.next=11,d.json();case 11:(u=e.sent).error?s(u.error):n(u.list_import_data),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),s(X);case 18:a.setState({isChecking:!1});case 19:case"end":return e.stop()}}),e,null,[[5,15]])}))),a.state={file:null,fileName:"",isChecking:!1},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.fileName,n=t.file,r=t.isChecking,s=this.context.importStatus;return Object(Oe.jsx)("div",{className:"col-sm-12",children:Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsxs)("div",{className:"col-sm-12",children:[Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsx)("div",{className:"col-md-2 col-cd",children:Object(Oe.jsx)("label",{children:y})})}),Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsx)("div",{className:"margin width-10percent",children:Object(Oe.jsx)("div",{children:Object(Oe.jsxs)("select",{className:"form-control",defaultValue:"author_db",onChange:this.onChangeTarget,children:[Object(Oe.jsx)("option",{value:"author_db",children:k}),Object(Oe.jsx)("option",{value:"id_prefix",children:I}),Object(Oe.jsx)("option",{value:"affiliation_id",children:N})]})})})}),Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsx)("div",{className:"col-md-2 col-cd",children:Object(Oe.jsx)("label",{children:v})})}),Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsxs)("div",{className:"col-md-8 margin",children:[Object(Oe.jsxs)("div",{children:[Object(Oe.jsx)("button",{className:"btn btn-primary",disabled:s===de,onClick:function(){e.inputFileElement.click()},children:v}),Object(Oe.jsx)("input",{type:"file",className:"hide",ref:function(t){return e.inputFileElement=t},accept:".tsv,.csv",onChange:this.onChangeFile})]}),Object(Oe.jsx)("div",{className:"block-placeholder",children:a?Object(Oe.jsx)("p",{className:"active",children:a}):Object(Oe.jsx)("p",{children:_})})]})}),Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsx)("div",{className:"col-md-2",children:Object(Oe.jsxs)("button",{className:"btn btn-primary",disabled:!n||s===de,onClick:this.onCheckImportFile,children:[r?Object(Oe.jsx)("div",{className:"loading"}):Object(Oe.jsx)("span",{className:"glyphicon glyphicon-download-alt icon"}),g]})})})]})})})}}])}(r.a.Component);ve.contextType=je;var _e=ve,ge=a(16),ye=a(79),ke=a.n(ye),Ie=a(239),Ne=a.n(Ie),we=function(e){function t(){var e;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=Object(u.a)(this,t,[].concat(n))).handleDownload=function(){var t=e.context.records.map((function(e,t){var a=e.emailInfo?be(e.emailInfo.map((function(e){return e.email}))).join("\n"):"",n=e.errors?e.errors.map((function(e){return V+": "+e})).join("\n").replace("<br/>","\n"):"",r=e.warnings?e.warnings.map((function(e){return q+": "+e})).join("\n").replace("<br/>","\n"):"";return Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)({},f,t+1),x,e.pk_id),O,e.fullname.join("\n")),D,a),M,(e.errors?n:"new"===e.status?z:"update"===e.status?K:"deleted"===e.status?Q:"")+(r?"\n":"")+r)}));t&&pe(t,"Creator_Check_"+ke()().format("YYYYDDMM"),!0)},e.handleDownloadForPrefix=function(){var t=e.context.records.map((function(e,t){var a=e.errors?e.errors.map((function(e){return V+": "+e})).join("\n").replace("<br/>","\n"):"";return Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)({},f,t+1),F,e.scheme),L,e.name),P,e.url),M,e.errors?a:"new"===e.status?z:"update"===e.status?K:"deleted"===e.status?Q:"")}));t&&pe(t,"Creator_Check_"+ke()().format("YYYYDDMM"),!0)},e.summaryDataImport=function(e){return{numTotal:e.length,numNews:e.filter((function(e){return"new"===e.status&&!e.errors})).length,numUpdates:e.filter((function(e){return"update"===e.status&&!e.errors})).length,numDeleteds:e.filter((function(e){return"deleted"===e.status&&!e.errors})).length,numErrors:e.filter((function(e){return e.errors})).length}},e.renderTableItem=function(e){return e.map((function(e,t){return Object(Oe.jsxs)("tr",{children:[Object(Oe.jsx)("td",{children:t+1}),Object(Oe.jsx)("td",{children:e.pk_id}),Object(Oe.jsx)("td",{children:e.fullname.map((function(e){return Object(Oe.jsx)("span",{className:"newline",children:e},t)}))}),Object(Oe.jsx)("td",{children:e.emailInfo?e.emailInfo.map((function(e,t){return Object(Oe.jsx)("span",{className:"newline",children:e.email},t)})):Object(Oe.jsx)(Oe.Fragment,{})}),Object(Oe.jsxs)("td",{children:[e.errors?e.errors.map((function(e){return Object(Oe.jsx)("div",{dangerouslySetInnerHTML:{__html:V+": "+e}})})):"new"===e.status?z:"update"===e.status?K:"deleted"===e.status?Q:"",e.warnings&&e.warnings.map((function(e){return Object(Oe.jsx)("div",{dangerouslySetInnerHTML:{__html:q+": "+e}})}))]})]},t)}))},e.renderTableItemForPrefix=function(e){return e.map((function(e,t){return Object(Oe.jsxs)("tr",{children:[Object(Oe.jsx)("td",{children:t+1}),Object(Oe.jsx)("td",{children:e.scheme}),Object(Oe.jsx)("td",{children:e.name}),Object(Oe.jsx)("td",{children:e.url}),Object(Oe.jsx)("td",{children:e.errors?e.errors.map((function(e){return Object(Oe.jsx)("div",{dangerouslySetInnerHTML:{__html:V+": "+e}})})):"new"===e.status?z:"update"===e.status?K:"deleted"===e.status?Q:""})]},t)}))},e.onImport=Object(l.a)(Object(i.a)().mark((function t(){var a,n,r,s,c,l,o,d,u,m;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.context,n=a.records,r=a.setErrorMessage,s=a.setTaskData,c=a.isTarget,l="",t.prev=2,o=localStorage.getItem(me),d=n.filter((function(e){return!e.errors})),t.next=7,fetch(ne.import,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_task_id:o,records:Ne()(d.map((function(e){var t=xe.a.cloneDeep(e);return delete t.fullname,delete t.warnings,t}))),isTarget:c})});case 7:return u=t.sent,t.next=10,u.json();case 10:(m=t.sent).data?(m.data.tasks.forEach((function(e,t){e.fullname=d[t].fullname,e.type=d[t].status})),s(m.data.group_task_id,m.data.tasks)):m.is_available||(l=m.celery_not_run?Z:m.continue_data?$:ee),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(2),console.log(t.t0),l=X;case 18:r(l);case 19:case"end":return t.stop()}}),t,null,[[2,14]])}))),e}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e,t,a=this.context,n=a.records,r=a.importStatus,s=a.isTarget,c=this.summaryDataImport(n),i=c.numTotal,l=c.numNews,o=c.numUpdates,d=c.numDeleteds,u=c.numErrors,m=[];return"author_db"===s?(e=this.handleDownload,m.push(x),m.push(O),m.push(D),t=this.renderTableItem(n)):"id_prefix"!==s&&"affiliation_id"!==s||(e=this.handleDownloadForPrefix,m.push(F),m.push(L),m.push(P),t=this.renderTableItemForPrefix(n)),Object(Oe.jsx)("div",{className:"check-component",children:Object(Oe.jsxs)("div",{className:"row",children:[Object(Oe.jsx)("div",{className:"col-md-12 text-center",children:Object(Oe.jsxs)("button",{className:"btn btn-primary",onClick:this.onImport,disabled:r!==oe,children:[r===de?Object(Oe.jsx)("div",{className:"loading"}):Object(Oe.jsx)("span",{className:"glyphicon glyphicon-download-alt icon"}),b]})}),Object(Oe.jsx)("div",{className:"col-md-12 text-center",children:Object(Oe.jsxs)("div",{className:"row block-summary",children:[Object(Oe.jsxs)("div",{className:"col-lg-2 col-md-3 col-sm-3",children:[Object(Oe.jsx)("h3",{children:Object(Oe.jsx)("b",{children:w})}),Object(Oe.jsxs)("div",{className:"flex-box",children:[Object(Oe.jsxs)("div",{children:[E,":"]}),Object(Oe.jsx)("div",{children:i})]}),Object(Oe.jsxs)("div",{className:"flex-box",children:[Object(Oe.jsxs)("div",{children:[S,":"]}),Object(Oe.jsx)("div",{children:l})]}),Object(Oe.jsxs)("div",{className:"flex-box",children:[Object(Oe.jsxs)("div",{children:[T,":"]}),Object(Oe.jsx)("div",{children:o})]}),Object(Oe.jsxs)("div",{className:"flex-box",children:[Object(Oe.jsxs)("div",{children:[B,":"]}),Object(Oe.jsx)("div",{children:d})]}),Object(Oe.jsxs)("div",{className:"flex-box",children:[Object(Oe.jsxs)("div",{children:[C,":"]}),Object(Oe.jsx)("div",{children:u})]})]}),Object(Oe.jsx)("div",{className:"col-lg-10 col-md-9 text-align-right",children:Object(Oe.jsxs)("button",{className:"btn btn-primary",onClick:e,children:[Object(Oe.jsx)("span",{className:"glyphicon glyphicon-cloud-download icon"}),p]})})]})}),Object(Oe.jsx)("div",{className:"col-md-12 m-t-20",children:Object(Oe.jsxs)("table",{className:"table table-striped table-bordered",children:[Object(Oe.jsx)("thead",{children:Object(Oe.jsxs)("tr",{children:[Object(Oe.jsx)("th",{children:f}),Object(Oe.jsx)("th",{children:m[0]}),Object(Oe.jsx)("th",{children:Object(Oe.jsx)("p",{className:"table-title-170",children:m[1]})}),Object(Oe.jsx)("th",{children:Object(Oe.jsx)("p",{className:"table-title-170",children:m[2]})}),Object(Oe.jsx)("th",{children:Object(Oe.jsx)("p",{className:"table-title-100",children:M})})]})}),Object(Oe.jsx)("tbody",{children:t})]})})]})})}}])}(r.a.Component);we.contextType=je;var Ee=we,Se=function(e){function t(){var e;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=Object(u.a)(this,t,[].concat(n))).prepareDisplayStatus=function(e,t,a){var n="";switch(e){case"PENDING":n=R;break;case"SUCCESS":n=function(e){var t="";switch(e){case"new":t=J;break;case"update":t=H;break;case"deleted":t=G}return t}(t);break;case"FAILURE":n=V+": "+("delete_author_link"===a?ae:te)}return n},e.handleDownload=Object(l.a)(Object(i.a)().mark((function t(){var a,n;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.context.tasks,(n=a.map((function(t,a){return Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)({},f,a+1),Y,t.start_date?t.start_date:""),A,t.end_date?t.end_date:""),x,t.record_id||""),O,t.fullname.join("\n")),U,e.prepareDisplayStatus(t.status,t.type,t.error_id))})))&&pe(n,"Creator_List_Download_"+ke()().format("YYYYDDMM"),!0);case 3:case"end":return t.stop()}}),t)}))),e.handleDownloadForPrefix=Object(l.a)(Object(i.a)().mark((function t(){var a,n,r,s;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.context,n=a.tasks,r=a.isTarget,(s=n.map((function(t,a){return Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)(Object(ge.a)({},f,a+1),Y,t.start_date?t.start_date:""),A,t.end_date?t.end_date:""),F,t.scheme||""),L,t.name||""),U,e.prepareDisplayStatus(t.status,t.type,t.error_id))})))&&pe(s,("Id_Prefix"===r?"ID_Prefix":"Affiliation_Id")+"_List_Download_"+ke()().format("YYYYDDMM"),!0);case 3:case"end":return t.stop()}}),t)}))),e.renderTableItem=function(t){return t.map((function(t,a){return Object(Oe.jsxs)("tr",{children:[Object(Oe.jsx)("td",{children:a+1}),Object(Oe.jsx)("td",{children:t.start_date?t.start_date:""}),Object(Oe.jsx)("td",{children:t.end_date?t.end_date:""}),Object(Oe.jsx)("td",{children:t.record_id||""}),Object(Oe.jsx)("td",{children:t.fullname.map((function(e){return Object(Oe.jsx)("span",{className:"newline",children:e},a)}))}),Object(Oe.jsx)("td",{children:e.prepareDisplayStatus(t.status,t.type,t.error_id)})]},a)}))},e.renderTableItemForPrefix=function(t){return t.map((function(t,a){return Object(Oe.jsxs)("tr",{children:[Object(Oe.jsx)("td",{children:a+1}),Object(Oe.jsx)("td",{children:t.start_date?t.start_date:""}),Object(Oe.jsx)("td",{children:t.end_date?t.end_date:""}),Object(Oe.jsx)("td",{children:t.scheme||""}),Object(Oe.jsx)("td",{children:t.name||""}),Object(Oe.jsx)("td",{children:e.prepareDisplayStatus(t.status,t.type,t.error_id)})]},a)}))},e}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e,t,a=this.context,n=a.tasks,r=a.recordNames,s=a.importStatus,c=a.isTarget,i=[];return"author_db"===c?(e=this.handleDownload,i.push(x),i.push(O),t=this.renderTableItem(n,r)):"id_prefix"!==c&&"affiliation_id"!==c||(e=this.handleDownloadForPrefix,i.push(F),i.push(L),t=this.renderTableItemForPrefix(n)),Object(Oe.jsxs)("div",{className:"result_container row",children:[Object(Oe.jsx)("div",{className:"col-md-12 text-align-right",children:Object(Oe.jsxs)("button",{className:"btn btn-primary",onClick:e,disabled:s===de,children:[Object(Oe.jsx)("span",{className:"glyphicon glyphicon-cloud-download icon"}),p]})}),Object(Oe.jsx)("div",{className:"col-md-12 m-t-20",children:Object(Oe.jsxs)("table",{className:"table table-striped table-bordered",children:[Object(Oe.jsx)("thead",{children:Object(Oe.jsxs)("tr",{children:[Object(Oe.jsx)("th",{children:f}),Object(Oe.jsx)("th",{className:"start_date",children:Object(Oe.jsx)("p",{className:"t_head",children:Y})}),Object(Oe.jsx)("th",{className:"end_date",children:Object(Oe.jsx)("p",{className:"t_head ",children:A})}),Object(Oe.jsx)("th",{children:i[0]}),Object(Oe.jsx)("th",{children:Object(Oe.jsx)("p",{className:"table-title-170",children:i[1]})}),Object(Oe.jsx)("th",{children:Object(Oe.jsx)("p",{className:"table-title-100",children:U})})]})}),Object(Oe.jsx)("tbody",{children:t})]})})]})}}])}(r.a.Component);Se.contextType=je;var Te=_e,Be=Ee,Ce=Se,De=a(477),Me=function(e){var t=e.type,a=void 0===t?"danger":t,n=e.msg,r=void 0===n?"":n,s=e.onClose;return""!==r?Object(Oe.jsx)(De.a,{variant:a,onClose:s,className:"opacity1",dismissible:!0,children:Object(Oe.jsx)("div",{dangerouslySetInnerHTML:{__html:r}})}):""},Fe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,t,[e])).componentDidMount=function(){a.isImportAvailable()},a.setStep=function(e){a.setState({step:e})},a.setTarget=function(e){a.setState({isTarget:e})},a.onChangeTab=function(e){a.state.step>=ie.filter((function(t){return t.tab_key===e}))[0].step&&a.setState({tab:e})},a.setErrorMessage=function(e){a.setState({errorMsg:e})},a.setImportData=function(e){var t=e.filter((function(e){return!e.errors||0===e.errors.length})).length>0;e.forEach((function(e){e.fullname=he(e.authorNameInfo)})),a.setState({tab:"import",records:e,importStatus:t?oe:le,step:se,errorMsg:""})},a.setTaskData=function(e,t){localStorage.setItem(me,e),a.setState({tasks:t,tab:"result",step:ce,importStatus:de,task_ids:t.map((function(e){return e.task_id}))}),a.onCheckImportStatus()},a.isImportAvailable=Object(l.a)(Object(i.a)().mark((function e(){var t,n,r,s,c,l;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,n="",e.prev=2,r=ne.is_import_available,(s=localStorage.getItem(me))&&(r+="?group_task_id="+s),e.next=8,fetch(r,{method:"GET"});case 8:return c=e.sent,e.next=11,c.json();case 11:(l=e.sent).is_available?t=!0:l.celery_not_run?n=Z:l.continue_data?(n=$,l.continue_data.records.forEach((function(e){e.fullname=he(e.authorNameInfo)})),l.continue_data.tasks.forEach((function(e,t){e.fullname=l.continue_data.records[t].fullname,e.type=l.continue_data.records[t].status})),a.setState({records:l.continue_data.records}),a.setTaskData(l.continue_data.group_task_id,l.continue_data.tasks)):n=ee,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(e.t0),n=X;case 19:return a.setErrorMessage(n),e.abrupt("return",t);case 21:case"end":return e.stop()}}),e,null,[[2,15]])}))),a.onCheckImportStatus=Object(l.a)(Object(i.a)().mark((function e(){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var t=setInterval(Object(l.a)(Object(i.a)().mark((function n(){var r,s,c,l,o,d,u,m,j;return Object(i.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.state,s=r.tasks,c=r.task_ids,l=r.isTarget,o="",d=!0,n.prev=3,n.next=6,fetch(ne.check_import_status,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:c,isTarget:l})});case 6:return u=n.sent,n.next=9,u.json();case 9:(m=n.sent)?(j=m.map((function(e){var t=s.filter((function(t){return t.task_id===e.task_id})),a=!!(t&&t.length>0)&&t[0];return a&&(a.status=e.status,a.start_date=e.start_date,a.end_date=e.end_date,a.error_id=e.error_id,"PENDING"===e.status&&(d=!1)),a})),a.setState({tasks:j,importStatus:d?ue:de})):o=X,n.next=17;break;case 13:n.prev=13,n.t0=n.catch(3),console.log(n.t0),o=X;case 17:(o||d)&&(a.setErrorMessage(o),e(!d),clearInterval(t));case 18:case"end":return n.stop()}}),n,null,[[3,13]])}))),1e3)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),a.state={tab:"select",step:re,errorMsg:"",tasks:[],task_ids:[],records:[],importStatus:le,isShowMessage:!1,isTarget:"author_db",setStep:a.setStep,setTarget:a.setTarget,onChangeTab:a.onChangeTab,setErrorMessage:a.setErrorMessage,isImportAvailable:a.isImportAvailable,setImportData:a.setImportData,setTaskData:a.setTaskData},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.tab,n=t.errorMsg;return Object(Oe.jsxs)(je.Provider,{value:this.state,children:[Object(Oe.jsx)(Me,{type:"danger",msg:n,onClose:function(){return e.setState({errorMsg:""})}}),Object(Oe.jsx)("div",{className:"row",children:Object(Oe.jsxs)("div",{className:"col-sm-12",children:[Object(Oe.jsx)("ul",{className:"nav nav-tabs",children:ie.map((function(t,n){return Object(Oe.jsx)("li",{className:"".concat(t.tab_key===a?"active":""," nav-item"),onClick:function(){return e.onChangeTab(t.tab_key)},children:Object(Oe.jsx)("a",{className:"".concat(t.tab_key===a?"active":""," nav-link cursor-pointer"),children:t.tab_name})},n)}))}),Object(Oe.jsxs)("div",{className:"tab-content",children:[Object(Oe.jsx)("div",{className:"".concat(a===ie[0].tab_key?"":"hide"),children:Object(Oe.jsx)(Te,{})}),Object(Oe.jsx)("div",{className:"".concat(a===ie[1].tab_key?"":"hide"),children:Object(Oe.jsx)(Be,{})}),Object(Oe.jsx)("div",{className:"".concat(a===ie[2].tab_key?"":"hide"),children:Object(Oe.jsx)(Ce,{})})]})]})})]})}}])}(r.a.Component);c.a.render(Object(Oe.jsx)(r.a.StrictMode,{children:Object(Oe.jsx)(Fe,{})}),document.getElementById("app-author-import"))}},[[474,1,2]]]);
//# sourceMappingURL=main.62e03788.chunk.js.map