(this["webpackJsonpapp-author-import"]=this["webpackJsonpapp-author-import"]||[]).push([[0],{482:function(e,t,a){},491:function(e,t,a){"use strict";a.r(t);a(259),a(278);var n=a(1),r=a.n(n),c=a(63),s=a.n(c),i=a(18),l=a(17),o=a(33),d=a(55),u=a(56),m=a(58),j=a(57),h=(a(482),a(483),document.getElementById("select").value),b=document.getElementById("import").value,x=document.getElementById("result").value,p=document.getElementById("download").value,f=document.getElementById("no").value,O=document.getElementById("pk_id").value,g=document.getElementById("current_weko_id").value,v=document.getElementById("new_weko_id").value,_=document.getElementById("previous_weko_id").value,y=document.getElementById("name").value,k=document.getElementById("select_file").value,N=document.getElementById("selected_file_name").value,w=document.getElementById("next").value,I=document.getElementById("cancel").value,C=document.getElementById("force_change_mode").value,E=document.getElementById("disclaimer_1").value,S=document.getElementById("disclaimer_2").value,B=document.getElementById("disclaimer_3").value,T=document.getElementById("disclaimer_4").value,P=document.getElementById("disclaimer_5").value,D=document.getElementById("disclaimer_6").value,M=document.getElementById("i_agree").value,L=document.getElementById("import_target").value,R=document.getElementById("author_db_label").value,F=document.getElementById("id_prefix_label").value,A=document.getElementById("affiliation_id_label").value,Y=document.getElementById("summary").value,U=document.getElementById("total").value,J=document.getElementById("new_creator").value,G=document.getElementById("update_creator").value,H=document.getElementById("delete_creator").value,K=document.getElementById("check_error").value,V=document.getElementById("mail_address").value,q=document.getElementById("check_result").value,z=document.getElementById("scheme").value,Q=document.getElementById("scheme_name").value,W=document.getElementById("scheme_url").value,X=document.getElementById("start_date").value,Z=document.getElementById("end_date").value,$=document.getElementById("status").value,ee=document.getElementById("to_do").value,te=document.getElementById("pending").value,ae=document.getElementById("success").value,ne=document.getElementById("failure").value,re=document.getElementById("register_success").value,ce=document.getElementById("update_success").value,se=document.getElementById("delete_success").value,ie=document.getElementById("error").value,le=document.getElementById("warning").value,oe=document.getElementById("register").value,de=document.getElementById("update").value,ue=document.getElementById("deleted").value,me=document.getElementById("different_format_file_for_target").value,je=document.getElementById("internal_server_error").value,he=document.getElementById("celery_not_run").value,be=document.getElementById("not_available_error").value,xe=document.getElementById("not_available_error_another").value,pe=document.getElementById("import_fail_error").value,fe=document.getElementById("delete_author_link").value,Oe=JSON.parse(document.getElementById("import_authors_entrypoints").value),ge=0,ve=1,_e=2,ye=[{tab_key:"select",tab_name:h,step:ge},{tab_key:"import",tab_name:b,step:ve},{tab_key:"result",tab_name:x,step:_e}],ke=0,Ne=1,we=2,Ie=3,Ce="import_author_task_id",Ee=r.a.createContext({}),Se=function(e){return e&&(t=e.map((function(e){var t=e.familyName&&e.firstName?", ":"";return e.familyName+t+e.firstName})))?t.filter((function(e){return null!=e&&""!==e})):[];var t},Be=function(e,t,a){var n="object"!==typeof e?JSON.parse(e):e,r="";if(a){var c="";for(var s in n[0])c+=s+"\t";r+=(c=c.slice(0,-1))+"\r\n"}for(var i=0;i<n.length;i++){var l="";for(var o in n[i])l+='"'+n[i][o]+'"\t';r+=(l=l.slice(0,-1))+"\r\n"}if(""!==r){var d=t.replace(/ /g,"_")+".tsv",u=new Blob([r],{type:"text/tsv"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(u,d);else{var m=window.URL.createObjectURL(u),j=document.createElement("a");j.style.display="none",j.href=m,j.download=d,document.body.appendChild(j),j.click(),document.body.removeChild(j),window.URL.revokeObjectURL(m)}}else alert("Invalid data")},Te=a(493),Pe=a(174),De=a.n(Pe),Me=a(0),Le=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,t,[e])).setIsCheckedState=function(e){a.setState({isChecked:e})},a.setModalState=function(e){a.setState({showConfirmModal:e})},a.setModalCheckboxState=function(e){a.setState({modalCheckbox:e})},a.getLastString=function(e,t){return e.split(t).pop()},a.onChangeTarget=function(e){var t=a.context.setTarget;a.setState({file:null,fileName:""}),t(e.target.value)},a.onChangeFile=function(){var e=Object(o.a)(Object(l.a)().mark((function e(t){var n,r,c,s,i,o,d,u,m,j,h,b,x,p;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.context,r=n.isTarget,c=n.setErrorMessage,s=t.target.files[0],i=a.getLastString(t.target.value,"\\"),"tsv"===a.getLastString(i,".")){e.next=5;break}return e.abrupt("return",!1);case 5:a.setState({fileName:i}),o=s.stream().getReader(),d=new TextDecoder("utf-8"),u="",m="",j=!0;case 11:if(!j){e.next=30;break}return e.next=14,o.read();case 14:if(h=e.sent,b=h.done,x=h.value,!b){e.next=19;break}return e.abrupt("break",30);case 19:if(u+=d.decode(x,{stream:!0}),m=u.split("\n")[0],a.validateFirstLine(r,m)){e.next=27;break}return c(me),e.abrupt("return");case 27:j=!1;case 28:e.next=11;break;case 30:(p=new FileReader).onload=function(){a.setState({file:p.result})},p.readAsDataURL(s);case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.validateFirstLine=function(e,t){var a=!0,n=t.trim();return"id_prefix"===e?a="#author_prefix_settings"===n:"affiliation_id"===e?a="#author_affiliation_settings"===n:"author_db"===e&&(a="#author_prefix_settings"!==n&&"#author_affiliation_settings"!==n),a},a.onCheckImportFile=Object(o.a)(Object(l.a)().mark((function e(){var t,n,r,c,s,i,o,d,u,m,j;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.context,n=t.setImportData,r=t.setErrorMessage,c=t.isTarget,s=t.setIsAgree,i=a.state,o=i.fileName,d=i.file,u=i.isChecked,d){e.next=4;break}return e.abrupt("return");case 4:return a.setState({isChecking:!0}),e.prev=5,e.next=8,fetch(Oe.check_import_file,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_name:o,file:d,target:c})});case 8:return m=e.sent,e.next=11,m.json();case 11:(j=e.sent).error?r(j.error):(n(j),s(u)),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r(je);case 18:a.setState({isChecking:!1});case 19:case"end":return e.stop()}}),e,null,[[5,15]])}))),a.handleCheckboxChange=function(e){e.target.checked?(a.setIsCheckedState(e.target.checked),a.setModalState(1)):a.setIsCheckedState(e.target.checked)},a.handleModalAction=function(e){a.setModalState(0),e&&a.setIsCheckedState(!0)},a.handleModalClose=function(){a.setModalState(0),a.setIsCheckedState(!1),a.setModalCheckboxState(!1)},a.state={file:null,fileName:"",isChecking:!1,isChecked:!1,showConfirmModal:!1,modalCheckbox:!1},a}return Object(j.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.context,a=t.importStatus,n=t.isTarget,r=this.state,c=r.fileName,s=r.file,i=r.isChecking,l=r.isChecked,o=r.showConfirmModal,d=r.modalCheckbox;return Object(Me.jsxs)("div",{className:"col-sm-12",children:[Object(Me.jsx)("div",{className:"row",children:Object(Me.jsxs)("div",{className:"col-sm-12",children:[Object(Me.jsx)("div",{className:"row",children:Object(Me.jsx)("div",{className:"col-md-2 col-cd",children:Object(Me.jsx)("label",{children:L})})}),Object(Me.jsx)("div",{className:"row",children:Object(Me.jsx)("div",{className:"margin width-10percent",children:Object(Me.jsx)("div",{children:Object(Me.jsxs)("select",{className:"form-control",defaultValue:"author_db",onChange:this.onChangeTarget,children:[Object(Me.jsx)("option",{value:"author_db",children:R}),Object(Me.jsx)("option",{value:"id_prefix",children:F}),Object(Me.jsx)("option",{value:"affiliation_id",children:A})]})})})}),Object(Me.jsx)("div",{className:"row",children:Object(Me.jsx)("div",{className:"col-md-2 col-cd",children:Object(Me.jsx)("label",{children:k})})}),Object(Me.jsx)("div",{className:"row",children:Object(Me.jsxs)("div",{className:"col-md-8 margin",children:[Object(Me.jsxs)("div",{children:[Object(Me.jsx)("button",{className:"btn btn-primary",disabled:a===we,onClick:function(){e.inputFileElement.click()},children:k}),Object(Me.jsx)("input",{type:"file",className:"hide",ref:function(t){return e.inputFileElement=t},accept:".tsv,.csv",onChange:this.onChangeFile})]}),Object(Me.jsx)("div",{className:"block-placeholder",children:c?Object(Me.jsx)("p",{className:"active",children:c}):Object(Me.jsx)("p",{children:N})})]})}),Object(Me.jsx)("div",{className:"row",children:Object(Me.jsxs)("label",{children:[Object(Me.jsx)("input",{type:"checkbox",checked:l,onChange:this.handleCheckboxChange,disabled:"author_db"!==n||!s}),C]})}),Object(Me.jsx)("div",{className:"row",children:Object(Me.jsx)("div",{className:"col-md-2",children:Object(Me.jsxs)("button",{className:"btn btn-primary",disabled:!s||a===we||i,onClick:this.onCheckImportFile,children:[i?Object(Me.jsx)("div",{className:"loading"}):Object(Me.jsx)("span",{className:"glyphicon glyphicon-download-alt icon"}),w]})})})]})}),Object(Me.jsxs)(Te.a,{className:"opacity1",show:o,onHide:this.handleModalClose,dialogClassName:"w-725",centered:!0,children:[Object(Me.jsx)(Te.a.Header,{closeButton:!0,children:Object(Me.jsx)(Te.a.Title,{className:"in-line",children:C})}),Object(Me.jsxs)(Te.a.Body,{children:[Object(Me.jsx)("div",{className:"row modal-text",children:E}),Object(Me.jsx)("div",{className:"row modal-text",children:S}),Object(Me.jsx)("div",{className:"row modal-text",children:B}),Object(Me.jsx)("div",{className:"row modal-text",children:T}),Object(Me.jsx)("div",{className:"row modal-text",children:P}),Object(Me.jsx)("div",{className:"row modal-text",children:D}),Object(Me.jsx)("div",{className:"row modal-text",style:{marginTop:"5px"},children:Object(Me.jsxs)("label",{children:[Object(Me.jsx)("input",{type:"checkbox",checked:d,onChange:function(t){return e.setModalCheckboxState(t.target.checked)}}),M]})})]}),Object(Me.jsx)(Te.a.Footer,{children:Object(Me.jsx)("div",{className:"col-sm-12",children:Object(Me.jsxs)("div",{className:"row text-center",children:[Object(Me.jsx)("button",{variant:"primary",type:"button",className:"btn btn-default",onClick:function(){return e.handleModalAction(!0===o)},disabled:!d,children:"OK"}),Object(Me.jsx)("button",{variant:"secondary",type:"button",className:"btn btn-default cancel",onClick:this.handleModalClose,children:I})]})})})]})]})}}])}(r.a.Component);Le.contextType=Ee;var Re=Le,Fe=a(76),Ae=a.n(Fe),Ye=a(257),Ue=a.n(Ye),Je=function(e){function t(){var e;Object(d.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=Object(m.a)(this,t,[].concat(n))).handlePageChange=function(){var t=Object(o.a)(Object(l.a)().mark((function t(a){var n,r,c,s,i,o;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.context,r=n.setRecords,c=n.setErrorMessage,s=n.setCurrentPage,a){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,fetch("".concat(Oe.check_pagination,"?page_number=").concat(a),{method:"GET",headers:{"Content-Type":"application/json"}});case 6:return i=t.sent,t.next=9,i.json();case 9:(o=t.sent).error?c(o.error):(s(a),r(o),window.scrollTo(0,0)),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),c(je);case 16:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(e){return t.apply(this,arguments)}}(),e.summaryDataImport=function(e){return{numTotal:e.num_total,numNews:e.num_new,numUpdates:e.num_update,numDeleteds:e.num_delete,numErrors:e.num_error}},e.summaryDataImportForPrefix=function(e){return{numTotal:e.length,numNews:e.filter((function(e){return"new"===e.status&&!e.errors})).length,numUpdates:e.filter((function(e){return"update"===e.status&&!e.errors})).length,numDeleteds:e.filter((function(e){return"deleted"===e.status&&!e.errors})).length,numErrors:e.filter((function(e){return e.errors})).length}},e.handleDownload=Object(o.a)(Object(l.a)().mark((function t(){var a,n,r,c,s,i,o;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.context,n=a.setErrorMessage,r=a.maxPage,t.prev=1,t.next=4,fetch(Oe.check_file_download,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({max_page:r})});case 4:if(!(c=t.sent).ok){t.next=15;break}return t.next=8,c.blob();case 8:s=t.sent,i=window.URL.createObjectURL(s),(o=document.createElement("a")).href=i,o.download="Creator_Check_"+Ae()().format("YYYYMMDDhhmm")+".tsv",o.click(),window.URL.revokeObjectURL(i);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),n(je);case 20:case"end":return t.stop()}}),t,null,[[1,17]])}))),e.handleDownloadForPrefix=function(){var t=e.context,a=t.records,n=t.isTarget,r=a.map((function(e,t){var a=e.errors?e.errors.map((function(e){return ie+": "+e})).join("\n").replace("<br/>","\n"):"";return Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({},f,t+1),z,e.scheme),Q,e.name),W,e.url),q,e.errors?a:"new"===e.status?oe:"update"===e.status?de:"deleted"===e.status?ue:"")}));r&&Be(r,("Id_Prefix"===n?"ID_Prefix":"Affiliation_Id")+"_Check_"+Ae()().format("YYYYDDMM"),!0)},e.renderTableItem=function(t){var a=e.context.currentPage;return t.map((function(e,t){return Object(Me.jsxs)("tr",{children:[Object(Me.jsx)("td",{children:t+1+100*(a-1)}),Object(Me.jsx)("td",{children:e.current_weko_id}),Object(Me.jsx)("td",{children:e.weko_id}),Object(Me.jsx)("td",{children:e.fullname.map((function(e){return Object(Me.jsx)("span",{className:"newline",children:e},t)}))}),Object(Me.jsx)("td",{children:e.emailInfo?e.emailInfo.map((function(e,t){return Object(Me.jsx)("span",{className:"newline",children:e.email},t)})):Object(Me.jsx)(Me.Fragment,{})}),Object(Me.jsxs)("td",{children:[e.errors?e.errors.map((function(e){return Object(Me.jsx)("div",{dangerouslySetInnerHTML:{__html:ie+": "+e}})})):"new"===e.status?oe:"update"===e.status?de:"deleted"===e.status?ue:"",e.warnings&&e.warnings.map((function(e){return Object(Me.jsx)("div",{dangerouslySetInnerHTML:{__html:le+": "+e}})}))]})]},t)}))},e.renderTableItemForPrefix=function(e){return e.map((function(e,t){return Object(Me.jsxs)("tr",{children:[Object(Me.jsx)("td",{children:t+1}),Object(Me.jsx)("td",{children:e.scheme}),Object(Me.jsx)("td",{children:e.name}),Object(Me.jsx)("td",{children:e.url}),Object(Me.jsx)("td",{children:e.errors?e.errors.map((function(e){return Object(Me.jsx)("div",{dangerouslySetInnerHTML:{__html:ie+": "+e}})})):"new"===e.status?oe:"update"===e.status?de:"deleted"===e.status?ue:""})]},t)}))},e.onImport=Object(o.a)(Object(l.a)().mark((function t(){var a,n,r,c,s,i,o,d,u,m,j,h,b,x;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.context,n=a.records,r=a.setErrorMessage,c=a.setTaskData,s=a.isTarget,i=a.isAgree,o=a.maxPage,d=a.setResultSummary,u="",t.prev=2,m=localStorage.getItem(Ce),j=n.filter((function(e){return!e.errors})),t.next=7,fetch(Oe.import,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_task_id:m,force_change_mode:i,records:Ue()(j.map((function(e){var t=De.a.cloneDeep(e);return delete t.fullname,delete t.warnings,t}))),isTarget:s,max_page:o})});case 7:return h=t.sent,t.next=10,h.json();case 10:(b=t.sent).data?(x=b.records,b.data.tasks.forEach((function(e,t){x.forEach((function(e){e.fullname=Se(e.authorNameInfo)})),e.fullname=x[t].fullname,e.type=x[t].status})),d(b.count,0,0,b.count),c(b.data.group_task_id,b.data.tasks)):b.is_available||(u=b.celery_not_run?he:b.continue_data?be:xe),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(2),console.log(t.t0),u=je;case 18:r(u);case 19:case"end":return t.stop()}}),t,null,[[2,14]])}))),e}return Object(j.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e,t,a=this.context,n=a.records,r=a.importStatus,c=a.isTarget,s=a.counts,i=a.currentPage,l=a.maxPage,o=a.isAgree,d="author_db"===c?this.summaryDataImport(s):this.summaryDataImportForPrefix(n),u=d.numTotal,m=d.numNews,j=d.numUpdates,h=d.numDeleteds,x=d.numErrors,O=[];return"author_db"===c?(e=this.handleDownload,O.push(g),O.push(v),O.push(y),O.push(V),t=this.renderTableItem(n)):"id_prefix"!==c&&"affiliation_id"!==c||(e=this.handleDownloadForPrefix,O.push(z),O.push(Q),O.push(W),t=this.renderTableItemForPrefix(n)),Object(Me.jsx)("div",{className:"check-component",children:Object(Me.jsxs)("div",{className:"row",children:["author_db"===c&&!0===o&&Object(Me.jsx)("label",{style:{color:"red"},children:C}),Object(Me.jsx)("div",{className:"col-md-12 text-center",children:Object(Me.jsxs)("button",{className:"btn btn-primary",onClick:this.onImport,disabled:r!==Ne,children:[r===we?Object(Me.jsx)("div",{className:"loading"}):Object(Me.jsx)("span",{className:"glyphicon glyphicon-download-alt icon"}),b]})}),Object(Me.jsx)("div",{className:"col-md-12 text-center",children:Object(Me.jsxs)("div",{className:"row block-summary",children:[Object(Me.jsxs)("div",{className:"col-lg-2 col-md-3 col-sm-3",children:[Object(Me.jsx)("h3",{children:Object(Me.jsx)("b",{children:Y})}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[U,":"]}),Object(Me.jsx)("div",{children:u})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[J,":"]}),Object(Me.jsx)("div",{children:m})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[G,":"]}),Object(Me.jsx)("div",{children:j})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[H,":"]}),Object(Me.jsx)("div",{children:h})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[K,":"]}),Object(Me.jsx)("div",{children:x})]})]}),Object(Me.jsx)("div",{className:"col-lg-10 col-md-9 text-align-right",children:Object(Me.jsxs)("button",{className:"btn btn-primary",onClick:e,children:[Object(Me.jsx)("span",{className:"glyphicon glyphicon-cloud-download icon"}),p]})})]})}),Object(Me.jsx)("div",{className:"col-md-12 m-t-20",children:Object(Me.jsxs)("table",{className:"table table-striped table-bordered",children:[Object(Me.jsx)("thead",{children:Object(Me.jsxs)("tr",{children:[Object(Me.jsx)("th",{children:f}),O.map((function(e,t){return Object(Me.jsx)("th",{children:e})})),Object(Me.jsx)("th",{children:Object(Me.jsx)("p",{className:"table-title-100",children:q})})]})}),Object(Me.jsx)("tbody",{children:t})]})}),"\u3000  ","author_db"===c&&Object(Me.jsx)(Ge,{currentPage:i,totalPages:l,onPageChange:this.handlePageChange})]})})}}])}(r.a.Component);Je.contextType=Ee;var Ge=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,t,arguments)}return Object(j.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e=this.props,t=e.currentPage,a=e.totalPages,n=e.onPageChange,r=[],c=Math.max(1,t-5),s=Math.min(a,t+4),i=c;i<=s;i++)r.push(i);return Object(Me.jsx)("div",{className:"col-sm-12 col-md-12 alignCenter",children:Object(Me.jsxs)("ul",{className:"pagination",children:[Object(Me.jsx)("li",{className:"page-item ".concat(1===t?"disabled":""),children:Object(Me.jsx)("a",{onClick:function(){return n(t-1)},className:"page-link",children:"<"})}),r.map((function(e){return Object(Me.jsx)("li",{className:"page-item ".concat(e===t?"active":""),children:Object(Me.jsx)("a",{onClick:function(){return n(e)},className:"page-link",children:e})},e)})),Object(Me.jsx)("li",{className:"page-item ".concat(t===a?"disabled":""),children:Object(Me.jsx)("a",{onClick:function(){return n(t+1)},className:"page-link",children:">"})})]})})}}])}(r.a.Component),He=Je,Ke=function(e){function t(){var e;Object(d.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=Object(m.a)(this,t,[].concat(n))).prepareDisplayStatus=function(e,t,a){var n="";switch(e){case"PENDING":n=ee;break;case"SUCCESS":n=function(e){var t="";switch(e){case"new":t=re;break;case"update":t=ce;break;case"deleted":t=se}return t}(t);break;case"FAILURE":n=ie+": "+("delete_author_link"===a?fe:pe)}return n},e.handleDownload=Object(o.a)(Object(l.a)().mark((function t(){var a,n,r,c,s,o,d;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.context.tasks,n=a.map((function(t,a){return Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({},f,a+1),X,t.start_date?t.start_date:""),Z,t.end_date?t.end_date:""),O,t.record_id||""),_,t.previous_weko_id),v,t.new_weko_id),y,t.fullname.join("\n")),$,e.prepareDisplayStatus(t.status,t.type,t.error_id))})),t.prev=2,t.next=5,fetch(Oe.result_download,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({json:n})});case 5:return r=t.sent,t.next=8,r.blob();case 8:return c=t.sent,t.next=11,c.text();case 11:s=t.sent,console.log(s.length),45===s.length&&n?Be(n,"Creator_List_Download_"+Ae()().format("YYYYDDMM"),!0):r.ok&&(o=window.URL.createObjectURL(c),(d=document.createElement("a")).href=o,d.download="Creator_List_Download_"+Ae()().format("YYYYMMDDhhmm")+".tsv",d.click(),window.URL.revokeObjectURL(o)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(2),console.log(t.t0);case 19:case"end":return t.stop()}}),t,null,[[2,16]])}))),e.handlePageChange=function(){var t=Object(o.a)(Object(l.a)().mark((function t(a){var n,r,c;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.context,r=n.maxPage,n.setErrorMessage,c=n.setCurrentPage,a){t.next=3;break}return t.abrupt("return");case 3:if(!(a<1||a>r)){t.next=5;break}return t.abrupt("return");case 5:c(a);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleDownloadForPrefix=Object(o.a)(Object(l.a)().mark((function t(){var a,n,r,c;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.context,n=a.tasks,r=a.isTarget,(c=n.map((function(t,a){return Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({},f,a+1),X,t.start_date?t.start_date:""),Z,t.end_date?t.end_date:""),z,t.scheme||""),Q,t.name||""),$,e.prepareDisplayStatus(t.status,t.type,t.error_id))})))&&Be(c,("Id_Prefix"===r?"ID_Prefix":"Affiliation_Id")+"_List_Download_"+Ae()().format("YYYYDDMM"),!0);case 3:case"end":return t.stop()}}),t)}))),e.renderTableItem=function(t){var a=e.context.currentPage,n=100*(a-1),r=100*a;return(t=t.slice(n,r)).map((function(t,a){return Object(Me.jsxs)("tr",{children:[Object(Me.jsx)("td",{children:n+a+1}),Object(Me.jsx)("td",{children:t.start_date?t.start_date:""}),Object(Me.jsx)("td",{children:t.end_date?t.end_date:""}),Object(Me.jsx)("td",{children:t.previous_weko_id||""}),Object(Me.jsx)("td",{children:t.new_weko_id||""}),Object(Me.jsx)("td",{children:t.fullname.map((function(e){return Object(Me.jsx)("span",{className:"newline",children:e},a)}))}),Object(Me.jsx)("td",{children:e.prepareDisplayStatus(t.status,t.type,t.error_id)})]},a)}))},e.renderTableItemForPrefix=function(t){return t.map((function(t,a){return Object(Me.jsxs)("tr",{children:[Object(Me.jsx)("td",{children:a+1}),Object(Me.jsx)("td",{children:t.start_date?t.start_date:""}),Object(Me.jsx)("td",{children:t.end_date?t.end_date:""}),Object(Me.jsx)("td",{children:t.scheme||""}),Object(Me.jsx)("td",{children:t.name||""}),Object(Me.jsx)("td",{children:e.prepareDisplayStatus(t.status,t.type,t.error_id)})]},a)}))},e}return Object(j.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e,t,a=this.context,n=a.tasks,r=a.recordNames,c=a.importStatus,s=a.isTarget,i=a.currentPage,l=a.maxPage,o=a.total,d=a.success,u=a.failure,m=a.pending,j=[];return"author_db"===s?(e=this.handleDownload,j.push(_),j.push(v),j.push(y),t=this.renderTableItem(n,r)):"id_prefix"!==s&&"affiliation_id"!==s||(e=this.handleDownloadForPrefix,j.push(z),j.push(Q),t=this.renderTableItemForPrefix(n)),Object(Me.jsxs)("div",{className:"result_container row",children:[Object(Me.jsx)("div",{className:"col-md-12 text-center",children:Object(Me.jsxs)("div",{className:"row block-summary",children:["\u3000  ","author_db"===s&&Object(Me.jsxs)("div",{className:"col-lg-2 col-md-3 col-sm-3",children:[Object(Me.jsx)("h3",{children:Object(Me.jsx)("b",{children:Y})}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[U,":"]}),Object(Me.jsx)("div",{children:o})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[ae,":"]}),Object(Me.jsx)("div",{children:d})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[ne,":"]}),Object(Me.jsx)("div",{children:u})]}),Object(Me.jsxs)("div",{className:"flex-box",children:[Object(Me.jsxs)("div",{children:[te,":"]}),Object(Me.jsx)("div",{children:m})]})]}),Object(Me.jsx)("div",{className:"col-md-12 text-align-right",children:Object(Me.jsxs)("button",{className:"btn btn-primary",onClick:e,disabled:c===we,children:[Object(Me.jsx)("span",{className:"glyphicon glyphicon-cloud-download icon"}),p]})})]})}),Object(Me.jsxs)("div",{className:"col-md-12 m-t-20",children:[Object(Me.jsxs)("table",{className:"table table-striped table-bordered",children:[Object(Me.jsx)("thead",{children:Object(Me.jsxs)("tr",{children:[Object(Me.jsx)("th",{children:f}),Object(Me.jsx)("th",{className:"start_date",children:Object(Me.jsx)("p",{className:"t_head",children:X})}),Object(Me.jsx)("th",{className:"end_date",children:Object(Me.jsx)("p",{className:"t_head ",children:Z})}),j.map((function(e,t){return Object(Me.jsx)("th",{children:e})})),Object(Me.jsx)("th",{children:Object(Me.jsx)("p",{className:"table-title-100",children:$})})]})}),Object(Me.jsx)("tbody",{children:t})]}),Object(Me.jsxs)("div",{children:["\u3000","author_db"===s&&Object(Me.jsx)(Ve,{currentPage:i,totalPages:l,onPageChange:this.handlePageChange})]})]})]})}}])}(r.a.Component);Ke.contextType=Ee;var Ve=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,t,arguments)}return Object(j.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e=this.props,t=e.currentPage,a=e.totalPages,n=e.onPageChange,r=[],c=Math.max(1,t-5),s=Math.min(a,t+4),i=c;i<=s;i++)r.push(i);return Object(Me.jsx)("div",{className:"col-sm-12 col-md-12 alignCenter",children:Object(Me.jsxs)("ul",{className:"pagination",children:[Object(Me.jsx)("li",{className:"page-item ".concat(1===t?"disabled":""),children:Object(Me.jsx)("a",{onClick:function(){return n(t-1)},className:"page-link",children:"<"})}),r.map((function(e){return Object(Me.jsx)("li",{className:"page-item ".concat(e===t?"active":""),children:Object(Me.jsx)("a",{onClick:function(){return n(e)},className:"page-link",children:e})},e)})),Object(Me.jsx)("li",{className:"page-item ".concat(t===a?"disabled":""),children:Object(Me.jsx)("a",{onClick:function(){return n(t+1)},className:"page-link",children:">"})})]})})}}])}(r.a.Component),qe=Re,ze=He,Qe=Ke,We=a(494),Xe=function(e){var t=e.type,a=void 0===t?"danger":t,n=e.msg,r=void 0===n?"":n,c=e.onClose;return""!==r?Object(Me.jsx)(We.a,{variant:a,onClose:c,className:"opacity1",dismissible:!0,children:Object(Me.jsx)("div",{dangerouslySetInnerHTML:{__html:r}})}):""},Ze=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,t,[e])).componentDidMount=function(){a.isImportAvailable()},a.setStep=function(e){a.setState({step:e})},a.setTarget=function(e){a.setState({isTarget:e})},a.setRecords=function(e){e.forEach((function(e){e.fullname=Se(e.authorNameInfo)})),a.setState({records:e})},a.setCurrentPage=function(e){a.setState({currentPage:e})},a.setResultSummary=function(e,t,n,r){a.setState({total:e,success:t,failure:n,pending:r})},a.onChangeTab=function(e){a.state.step>=ye.filter((function(t){return t.tab_key===e}))[0].step&&a.setState({tab:e})},a.setErrorMessage=function(e){a.setState({errorMsg:e})},a.setIsAgree=function(e){a.setState({isAgree:e})},a.setImportData=function(e){var t,n=e.counts||{},r=e.max_page;e=e.list_import_data,t=0===Object.keys(n).length?e.filter((function(e){return!e.errors||0===e.errors.length})).length>0:!(n.num_error===n.num_total),e.forEach((function(e){e.fullname=Se(e.authorNameInfo)})),a.setState({tab:"import",records:e,counts:n,maxPage:r,importStatus:t?Ne:ke,step:ve,errorMsg:""})},a.setTaskData=function(e,t){localStorage.setItem(Ce,e),a.setState({tasks:t,tab:"result",step:_e,currentPage:1,maxPage:Math.ceil(t.length/100),importStatus:we,task_ids:t.map((function(e){return e.task_id}))}),a.onCheckImportStatus()},a.isImportAvailable=Object(o.a)(Object(l.a)().mark((function e(){var t,n,r,c,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,n="",e.prev=2,r=Oe.is_import_available,(c=localStorage.getItem(Ce))&&(r+="?group_task_id="+c),e.next=8,fetch(r,{method:"GET"});case 8:return s=e.sent,e.next=11,s.json();case 11:(i=e.sent).is_available?t=!0:i.celery_not_run?n=he:i.continue_data?(n=be,i.continue_data.records.forEach((function(e){e.fullname=Se(e.authorNameInfo)})),i.continue_data.tasks.forEach((function(e,t){e.fullname=i.continue_data.records[t].fullname,e.type=i.continue_data.records[t].status})),a.setState({records:i.continue_data.records}),a.setTaskData(i.continue_data.group_task_id,i.continue_data.tasks)):n=xe,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(e.t0),n=je;case 19:return a.setErrorMessage(n),e.abrupt("return",t);case 21:case"end":return e.stop()}}),e,null,[[2,15]])}))),a.onCheckImportStatus=Object(o.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var t=setInterval(Object(o.a)(Object(l.a)().mark((function n(){var r,c,s,i,o,d,u,m,j,h,b,x,p,f;return Object(l.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.state,c=r.tasks,s=r.task_ids,i=r.isTarget,o=r.total,d="",u=!0,n.prev=3,n.next=6,fetch(Oe.check_import_status,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:s,isTarget:i})});case 6:return m=n.sent,n.next=9,m.json();case 9:(j=n.sent)?("author_db"===i?(b=j.tasks,h=b.map((function(e){var t=c.filter((function(t){return t.task_id===e.task_id})),a=!!(t&&t.length>0)&&t[0];return a&&(a.status=e.status,a.start_date=e.start_date,a.end_date=e.end_date,a.error_id=e.error_id,"PENDING"===e.status&&(u=!1)),a})),j.over_max&&("PENDING"===(x=j.over_max.status)?u=!1:"FAILURE"===x&&(d=pe)),p=j.summary,f=o-(j.summary.success_count+j.summary.failure_count),a.setResultSummary(o,p.success_count,p.failure_count,f)):h=j.map((function(e){var t=c.filter((function(t){return t.task_id===e.task_id})),a=!!(t&&t.length>0)&&t[0];return a&&(a.status=e.status,a.start_date=e.start_date,a.end_date=e.end_date,a.error_id=e.error_id,"PENDING"===e.status&&(u=!1)),a})),a.setState({tasks:h,importStatus:u?Ie:we})):d=je,n.next=17;break;case 13:n.prev=13,n.t0=n.catch(3),console.log(n.t0),d=je;case 17:(d||u)&&(a.setErrorMessage(d),e(!u),clearInterval(t));case 18:case"end":return n.stop()}}),n,null,[[3,13]])}))),1e3)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),a.state=Object(i.a)(Object(i.a)(Object(i.a)({tab:"select",step:ge,errorMsg:"",tasks:[],task_ids:[],records:[],counts:{},currentPage:1,maxPage:0,importStatus:ke,isShowMessage:!1,isAgree:!1,isTarget:"author_db",total:0,success:0,failure:0,pending:0,setStep:a.setStep,setTarget:a.setTarget,onChangeTab:a.onChangeTab,setErrorMessage:a.setErrorMessage,isImportAvailable:a.isImportAvailable,setImportData:a.setImportData,setTaskData:a.setTaskData,setIsAgree:a.setIsAgree,setRecords:a.setRecords},"setTaskData",a.setTaskData),"setCurrentPage",a.setCurrentPage),"setResultSummary",a.setResultSummary),a}return Object(j.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.tab,n=t.errorMsg;return Object(Me.jsxs)(Ee.Provider,{value:this.state,children:[Object(Me.jsx)(Xe,{type:"danger",msg:n,onClose:function(){return e.setState({errorMsg:""})}}),Object(Me.jsx)("div",{className:"row",children:Object(Me.jsxs)("div",{className:"col-sm-12",children:[Object(Me.jsx)("ul",{className:"nav nav-tabs",children:ye.map((function(t,n){return Object(Me.jsx)("li",{className:"".concat(t.tab_key===a?"active":""," nav-item"),onClick:function(){return e.onChangeTab(t.tab_key)},children:Object(Me.jsx)("a",{className:"".concat(t.tab_key===a?"active":""," nav-link cursor-pointer"),children:t.tab_name})},n)}))}),Object(Me.jsxs)("div",{className:"tab-content",children:[Object(Me.jsx)("div",{className:"".concat(a===ye[0].tab_key?"":"hide"),children:Object(Me.jsx)(qe,{})}),Object(Me.jsx)("div",{className:"".concat(a===ye[1].tab_key?"":"hide"),children:Object(Me.jsx)(ze,{})}),Object(Me.jsx)("div",{className:"".concat(a===ye[2].tab_key?"":"hide"),children:Object(Me.jsx)(Qe,{})})]})]})})]})}}])}(r.a.Component);s.a.render(Object(Me.jsx)(r.a.StrictMode,{children:Object(Me.jsx)(Ze,{})}),document.getElementById("app-author-import"))}},[[491,1,2]]]);
//# sourceMappingURL=main.a853d84e.chunk.js.map