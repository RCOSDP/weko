{%- extends config.BASE_PAGE_TEMPLATE %}

{%- block css %}
{{ super() }}
{% assets "workflow_datepicker_css" %}<link href="{{ ASSET_URL }}" rel="stylesheet">{% endassets %}
{% assets "workflow_css" %}<link href="{{ ASSET_URL }}" rel="stylesheet">{% endassets %}
{%- endblock css %}

{%- block javascript %}
{{ super() }}
{% assets "workflow_activity_list_js" %}
<script src="{{ ASSET_URL }}"></script>{% endassets %}
{% assets "workflow_js" %}<script src="{{ ASSET_URL }}"></script>{% endassets %}
{% assets "weko_theme_js_widget" %}
<script src="{{ ASSET_URL }}"></script>{% endassets %}
{%- endblock javascript %}

{%- block page_body_tabs %}
{% from "weko_theme/macros/tabs_selector.html" import tabs_selector with context %}
{{ tabs_selector('large_file_upload',community_id) }}
{%- endblock page_body_tabs %}

{%- block page_header %}
{%-if not community %}
{{ super() }}
{%- endif %}
{%- endblock page_header %}

{%- block page_footer %}
{%-if not community%}
{{ super() }}
{%- endif %}
{%- endblock page_footer %}

{% block page_body %}
{%-if not community %}
{{ super() }}
{%- else %}
<div class="communities">
  <div id="community-id" name="community-id" hidden>{{ community.id }}</div>
  {{ community_header(community, subtitle='') }}
  <div id="page_body" class="grid-stack hidden" {%- if render_widgets %}style="display: None;" {%- endif %}>
    <div id="main_contents">
      {{ super() }}
    </div>
  </div>
  {%- from "weko_theme/macros/footer-community.html" import community_footer_widget %}
  {{ community_footer_widget(render_widgets, community, link=False, subtitle='') }}
</div>
<div class="communities"></div>
{%- endif %}
{% endblock page_body %}

{%- block page_body_main %}
<section name="upload_area">
  <h4>{{_('Large File Upload')}}</h4>
  <div>
    <section name="upload_controller">
      <!-- <h5>uploader</h5> -->
      <div class="row layout">
        <div class="input-group">
          <div class="col-md-12">
            <div class="col-md-2 col-cd">
              <label for="upload_id_text">{{ _('Upload Id') }}</label>
            </div>
            <div class="col-md-8">
              <input type="text" id="upload_id_text" class="form-control" placeholder="{{_('When you retry failed upload, Please input the Upload Id here.')}}"/>
            </div>
            <div class="col-xs-12"><label></label></div>
          </div>
          <div class="col-md-12">
            <div class="col-md-2 col-cd">
              <label for="upload_file_area" class="required">{{ _('File Select') }}</label>
            </div>
            <div class="col-md-8">
              <input type="file" id="upload_file_area" />
            </div>
          </div>
          <div class="col-xs-12"><label></label></div>
          <div class="row">
            <div class="col-md-12">
              <div class="col-md-2 col-cd">
              </div>
              <div class="col-md-8 col-xs-12 text-center">
                <button variant="primary" class="btn btn-sm btn-primary" type="submit" id="upload_button">{{_('Upload File')}}</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
    <section name="uploading_status">
      <!-- <h5>status</h5> -->
      <div class="row layout">
        <div>
          <div class="col-md-12">
            <div class="col-md-2 col-cd">
              <label>
                {{_('Status')}} : 
              </label>
            </div>
            <div class="row col-md-8">
              <div class="text-left">
                <span ng-show="f.progress < 100 &amp;&amp; !f.errored" class="ng-binding ng-hide"> %</span>
                <span ng-show="f.processing &amp;&amp; !f.errored" class="ng-hide">Processing...</span>
                <span ng-show="f.errored" class="text-danger ng-hide">Error</span>
                <span ng-show="f.completed" class="text-success ng-hide">âœ“</span>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="col-md-12">
            <div class="col-md-2 col-cd">
                <label>
                  {{_('Uploading Id')}} : 
                </label>
            </div>
            <div class="col-md-8">
              <label id="display_uploading_id"></label>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</section>
<hr>
<section name="history_area">
  <h4>{{_('History')}}</h4>
  {%-if not histories %}
    <span>{{_('No history yet')}}</span>
  {%- else %}
    <section name="history_page_limit">
      <div class="pull-right">
        <div class="form-group">
          <label for="page_count">{{_('Display Number')}}</label>
          <select class="form-control" id="page_count">
            <option value="20" {% if size==20 %} selected="selected" {% endif %}>20</option>
            <option value="50" {% if size==50 %} selected="selected" {% endif %}>50</option>
            <option value="75" {% if size==75 %} selected="selected" {% endif %}>75</option>
            <option value="100" {% if size==100 %} selected="selected" {% endif %}>100</option>
          </select>
        </div>
      </div>
    </section>  
    <section name="history_list">
      <div class="row">
        <div class="col-sm-12">
          <div class="table-responsive">
            <table class="table table-striped table-bordered table-responsive">
              <thead>
                <tr>
                    <th>{{ _('Upload Id') }}</th>
                    <th>{{ _('Result') }}</th>
                    <th>{{ _('Created') }}</th>
                    <th>{{ _('Updated') }}</th>
                    <th>{{ _('File Name') }}</th>
                    <th>{{ _('Size') }}</th>
                    <th style="display: none;">{{ _('Download') }}</th>
                </tr>
              </thead>
              <tbody>
              {%- for history in histories %}
                <tr class="">
                    <td scope="row"><span>{{history.upload_id}}</span></td>
                    <td><span>
                      {%-if history.completed %}{{ _('Success')}}{%- else %}{{ _('Failed')}}{%- endif %}
                    </span></td>
                    <td><span>{{history.created}}</span></td>
                    <td><span>{{history.updated}}</span></td>
                    <td><span>{{history.key}}</span></td>
                    <td><span>{{'{:,.0f}'.format(history.size)}}</span></td>
                    <td style="display: none;"><button type="button">{{ _('Download') }}</button></td>
                </tr>
              {%- endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
    <section name="history_pager">
      {% if maxpage|int >= 1 %}
        <div class="row">
          <div class="text-center">
            <ul class="pagination">
              {%-if pages|int <= 1 %}
              <li class="disabled">
                <a href="javascript:void(0)">&lt;</a>
              </li>
              {%-else%}
              {% set pagePrevious = pages|int - 1 %}
              <li>
                <a href="javascript:void(0)" class="get-pages" data-pages="{{pagePrevious}}">&lt;</a>
              </li>
              {%- endif%}
              {%- for index in range(maxpage|int) %}
    
              {%-if index+1 == pages|int %}
              <li class="active">
                <a href="javascript:void(0)">{{index+1}}</a>
              </li>
              {%-else%}
              {% set pagecurrent = index|int +1 %}
              <li>
                <a href="javascript:void(0)" class="get-pages" data-pages="{{pagecurrent}}">{{index+1}}</a>
              </li>
              {%- endif%}
              {%- endfor %}
              {%-if maxpage|int <= pages|int %}
              <li class="disabled">
                <a href="javascript:void(0)">&gt;</a>
              </li>
              {%-else%}
              {% set pageNext = pages|int + 1 %}
              <li>
                <a href="javascript:void(0)" class="get-pages" data-pages="{{pageNext}}">&gt;</a>
              </li>
              {%- endif%}
            </ul>
          </div>
        </div>
        {%- endif%}
    </section>
  {%- endif %}
<input type="hidden" id="retry_count" value="{{retry_count}}">
</section>
{%- endblock page_body_main %}
