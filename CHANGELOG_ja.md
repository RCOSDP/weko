# Change Log

このプロジェクトのすべての重要な変更は、このファイルに記録されます。

この変更履歴は [Keep a Changelog](http://keepachangelog.com/) に沿った形で記録されます。
このプロジェクトのバージョン番号は [Semantic Versioning](http://semver.org/) に従います。

## [Unreleased]
### 新機能
### 既存機能の変更
### 将来的に削除される機能
### 削除された機能
### バグフィックス
### 脆弱性対応等

## [v1.0.8a] 2025-07-08
### バグフィックス
- tikaライブラリがDockerイメージに格納されていなかった問題を修正しました。

## [v1.0.8] 2025-05-20
### 既存機能の変更
- tikaプロセスがメモリを消費している問題を改善しました。
- インデックス表示処理に含まれていた非効率な処理を効率化することで、インデックス表示を高速化しました。
- 初期インストール時のElasticsearchインデックス作成タイムアウト時間を30s→2mに変更しました。
### バグフィックス
- DBの接続タイムアウトにより一括インポート・一括エクスポートが失敗する問題を修正しました。
- Citation formatting for recordによる500エラーを修正しました
- DBセッション切れにより、「他のアクティビティを既に開いています」と表示され、アイテムを編集できない問題を修正しました。
‐ Redis のTTLが無期限と設定されることで、アクティビティがロックされる問題を修正しました。
- アクティビティにアクセスしようとすると、「The item you are editing has already been deleted.」とポップアップが表示される問題を改善しました。
- 想定していないクエリパラメータにより500エラーが発生している問題を修正しました。
- /items/exportで500エラーが発生している問題を修正しました。
- /admin/load_widget_design_settingで500エラーが発生している問題を修正しました。
- /get_uriで500エラーが発生している問題を修正しました。
- /api/stats/<record_id>で500エラーが発生している問題を修正しました。


## [v1.0.7b] 2025-01-06
### 既存機能の変更
- 移行機関とのデータ互換性を向上させました。
- reindex対象としてitemtype idを指定できるようになりました。
### バグフィックス
- 増加していたデータベースへのクエリ数を低減させました。

## [v1.0.7a2] - 2024-12-27
### 既存機能の変更
- メタデータ入力時の著者識別子URL、著者所属識別子URL等の修正を可能にしました。
### バグフィックス
- renderとformの不整合を修正するデータ修正ツール（itemtype_fix_form_title.py）のバグを修正しました。 
- アイテムタイトルのAllow Multipleにチェックが入っていない場合にアイテムインポートでエラーとなるバグを修正しました。
- サムネイル付きのアイテムインポートがエラーとなるバグを修正しました。
- 作成者識別子をhideにした場合にアイテム詳細画面がエラーで表示できなくなるバグを修正しました。


## [v1.0.7a] - 2024-10-29
## [v1.0.8a] - 2024-10-29
## [v1.0.9a] - 2024-10-29
### 既存機能の変更
- ユーザがアクティビティロックを強制的に解除できる機能を追加しました。
### バグフィックス
- 一つ目のインデックスのコメントで同一階層のインデックスのコメントが上書きされる問題を修正しました。
- アイテムタイプマッピングに含まれるデータエラーによりアイテム詳細画面、アイテムタイプ編集画面が表示できなくなる問題を修正しました。
- 複数タブでワークフローを開くとロックする機能が動作していない問題を修正しました。
- 学位論文のバリデーションチェックでStartPageが含まれている問題を修正しました。
- Shibbolethリダイレクト時のエンコード範囲に問題があった点を修正しました。
- アイテムタイプ修正ツールの問題の修正および状態を過去に戻すツールを追加しました。


## [v1.0.9] - 2024-10-03
### バグフィックス
- アイテムタイプを修正する「renew_all_item_types.py」の実行により、アイテムタイプの属性情報がクリアされる問題を修正。この問題によりクリアされた問題を指定日時に戻すツール「replace_item_type_data.py」を追加。
- インポート画面のエラーメッセージ「Item already DELIETED in the system」が日本語で表示されるよう修正

## [v1.0.8] - 2024-10-02
### 既存機能の変更
- フィードバックメール機能のメールアドレス抽出ロジックを変更
‐ シークレットURLボタンを代理投稿者も利用できるように機能を変更
‐ 管理画面のシークレットURL画面を整理
### バグフィックス
- JPCOARスキーマ2.0 カタログメタデータの修正
- インポート時の機能制限が解除されない場合がある問題の修正
- インデックスの一括削除機能の不具合の修正

## [v1.0.7] - 2024-09-09
### 新機能
- 詳細検索の日付入力で実在しない日付で検索できないようするバリデーション機能を追加
- メタデータ自動入力機能でCiNii ResearchのID指定による自動入力機能を追加
- ハーベスト設定されたインデックスの削除、編集ができないように機能を追加
- インポート中はアイテムタイプの削除、編集ができないように機能を追加
- アクティビティ実行での「戻るボタン」機能の追加
- アイテム編集時に起動されるアクティビティの選択条件として登録先インデックスを追加
- アイテム一覧の著者ID表示をアイコン表示となるよう機能を追加
- アイテムの過去バージョンを削除できるよう機能を追加
- Secret URL発行機能を追加
- JPCOAR 2.0スキーマによるOAIPMHプロバイダ、ハーベスタ機能を追加
- JPCOAR 2.0対応DOIバリデーション機能
### 既存機能の変更
- 登録済みアイテムをエクスポートする際、ファイル出力しなくてもTSVファイルに ファイルパスの値を含めるよう機能変更
- 全文テキスト抽出ロジックを変更
- 一括登録時やハーベスト時のアイテム作成イベント記録機能の一部修正と機能を追加
- ブラウザ時刻を利用していた処理をサーバ時刻で処理するよう機能変更
- Widget内でアップロードしたファイルをコンテンツに埋め込む際にFQDNでなっているものを、相対パスとなるよう機能を変更
- titleを複数マッピングした場合、プロパティ順序が先頭のプロパティを出力するよう機能を変更
- JaLC DOI の付与チェック時に「dc:title」の「xml:lang」属性を必須としないよう変更
- DOI付与済みアイテムの資源タイプ変更を一部可能にするよう機能を変更
### バグフィックス
- ユーザ名が記録されていない場合にエラーとなる問題の解決および一括登録時のセッション切れ対策機能の追加
- 複数マッピングによる問題を修正
- 複数ファイルを有するDOI取り下げ下済みアイテムを削除できない問題を修正
- 入力値がない場合に、アイテムタイプのstatic機能がうまく機能しない問題を修正
- 日本語表示でインデックスリストを表示する際、日本語名称がないインデックスが存在すると、その子インデックスも英語表示となる問題を修正
- 同一プロパティを複数利用している場合、表示オプションが上書きされてしまう問題を修正
- 登録者以外に公開日が未来日のアイテムがアイテム一覧に表示されない問題を修正
- 著者統合時のエラーが発生した場合のエラー処理の問題を修正
- 著者IDの追加を行うと、編集不可状態で追加される問題を修正
- 著者DB管理 > 一括登録 で登録したデータを「姓△名」で検索できない問題を修正
- 著者DBの当該著者の情報に「所属機関識別子」（とそれに対応する所属機関名）が設定されていない場合に著者統合が失敗する問題を修正
- 存在しないインデックスに対してアイテムインポートできないように修正
- 全文検索（コンテンツファイル本文）と詳細検索欄（メタデータ）の併用ができない問題を修正
- 新規アイテムの登録にて「Item Link」アクションでアイテムを紐付けた情報がアクティビティ終了後もDBに残る問題を修正
- 初期表示設定の「最も新しい公開アイテムの属するインデックス」の機能で所属インデックスの公開・非公開を確認していない問題を修正
- 公開日をhideにした場合、アイテム詳細画面のinformationボタンをクリックするとエラーになる問題を修正
- 検索結果が10,000件を超えた場合にページングが正しく処理されない場合がある問題を修正
- 一括登録時にファイルサイズを補完する機能が動作するよう修正
- 一括登録結果に複数のエラーが発生してもファイルを出力できるよう修正
- プロパティ属性がチェックボックスの場合、詳細検索の検索条件正しく表示されない問題を修正
- フィードバックメール欄に追加したメールアドレスが反映されない場合がある問題を修正
- ハーベスト時のエラーとして「TypeError: the JSON object must be str, bytes or bytearray, not 'list'」が出力される問題を修正
- コンテンツファイルをオブジェクトストレージに保存している場合にPDF変換機能が動作しない問題を修正
- カスタムレポートの集計範囲に当日を含めるよう修正
- カスタムソートの未指定アイテムの昇順・降順が機能していない問題の修正
- オープンアクセス日がUTC時間で表示される問題をローカル時間が表示されるように機能を修正
- インポート処理中に「サーバ内部エラー」となり中断する場合がある問題を修正
- インデックス名の変更が表示上反映されない問題を修正
- インデックス名にノーブレークスペースが含まれる場合に詳細検索画面が表示されなくなる問題を修正
- インデックスの集計ロジックを修正することで、インデックスが多い場合も処理できるよう修正
- アクティビティロックがアンロックできない問題を修正
- アイテム編集時のインデックス所属とアイテム表示画面でのインデックス所属が異なる問題を修正
- アイテム詳細画面のアクション「Information」ボタンで表示される「公開日」がファイルの属性情報を示していない問題を修正
- アイテム詳細画面のCite asの表示としてYYYY形式、YYYY-MM形式を受け入れられるよう機能を修正
- アイテム個別登録のインデックス選択画面にてアクティビティを終了すると、中途半端なアイテム情報が残ってしまう問題を修正
- アイテム一覧のソートのItemTypeが機能していない問題を修正
- アイテム一覧で「ID」を数値としてソートできるよう修正
- アイテムリスト（一覧形式）においてサムネイル画像の自動調整が正しく行われていない問題を修正
- アイテムのバージョン毎の表示数ランキングとなっていたのをアイテムの全バージョンの表示数ランキングとなるよう修正
- アイテムタイプ編集画面でHideにした項目をアイテムリストおよびCite asから非表示とするよう修正
- WEBコンテナのログにデバッグ用ログが表示される問題を修正
- SWORDv3でOAuth2が部分的に機能していないバグを修正
- hide項目のタイトル読みがタイトル、ランキング、アイテム一覧として表示されている問題を修正
- CNRIハンドル付与時のCNRIサーバエラーによりCNRIハンドルが付与されない問題を修正
- Cite asで英語タイトルしか持たないアイテムのタイトルが表示されない問題を修正
- Admin > Web Design > Widgetの画面でIDによる検索ができるように機能を修正
- 1つのアイテムに対して2つのアクティビティが生成されてしまう問題を修正
- 「Upgrade Version」時の「Item Link」情報が引き継がれない問題を修正
- 「Item Link」アクションでアイテム紐付け時に自アイテムの紐付けができてしまう問題を修正
- アイテムタイプ編集画面にて読み込み中が継続する問題を修正
- ログイン後、アイテム詳細画面でPublish Statusが表示されなくなる問題を修正


[v1.0.7] https://github.com/RCOSDP/weko/compare/v0.9.6...v1.0.7
[v1.0.7a] https://github.com/RCOSDP/weko/compare/v1.0.7...v1.0.7a
[v1.0.7a2] https://github.com/RCOSDP/weko/compare/v1.0.7a...v1.0.7a2
[v1.0.7b] https://github.com/RCOSDP/weko/compare/v1.0.7a2...v1.0.7b
[v1.0.8] https://github.com/RCOSDP/weko/compare/v1.0.7b...v1.0.8
[v1.0.8a] https://github.com/RCOSDP/weko/compare/v1.0.8...v1.0.8a
